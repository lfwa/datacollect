
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://lfwa.github.io/datadynamics/api/environments/">
      
      
        <link rel="prev" href="../../tutorials/collector_tutorial/">
      
      
        <link rel="next" href="../policies/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.13">
    
    
      
        <title>Simulation Environments - Datadynamics</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.85bb2934.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a6bdf11c.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#simulation-environments" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Datadynamics" class="md-header__button md-logo" aria-label="Datadynamics" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Datadynamics
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Simulation Environments
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/lfwa/datadynamics" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    lfwa/datadynamics
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../tutorials/graph_collector_tutorial/" class="md-tabs__link">
        Tutorials
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="./" class="md-tabs__link md-tabs__link--active">
        API
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Datadynamics" class="md-nav__button md-logo" aria-label="Datadynamics" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Datadynamics
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/lfwa/datadynamics" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    lfwa/datadynamics
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/graph_collector_tutorial/" class="md-nav__link">
        Simulating Data Collection Dynamics with a Graph
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/collector_tutorial/" class="md-nav__link">
        Simulating Data Collection Dynamics in a Plane
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Simulation Environments
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Simulation Environments
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#collector-2d" class="md-nav__link">
    Collector (2D)
  </a>
  
    <nav class="md-nav" aria-label="Collector (2D)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.collector.collector" class="md-nav__link">
    datadynamics.environments.collector.collector
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.collector.collector.SamplingWrapperEnv" class="md-nav__link">
    SamplingWrapperEnv
  </a>
  
    <nav class="md-nav" aria-label="SamplingWrapperEnv">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.collector.collector.SamplingWrapperEnv.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.collector.collector.SamplingWrapperEnv.reset" class="md-nav__link">
    reset()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.collector.collector.raw_env" class="md-nav__link">
    raw_env
  </a>
  
    <nav class="md-nav" aria-label="raw_env">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.collector.collector.raw_env.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.collector.collector.raw_env.reward" class="md-nav__link">
    reward()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.collector.collector.env" class="md-nav__link">
    env()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#graph-collector" class="md-nav__link">
    Graph Collector
  </a>
  
    <nav class="md-nav" aria-label="Graph Collector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.graph_collector.graph_collector" class="md-nav__link">
    datadynamics.environments.graph_collector.graph_collector
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.graph_collector.graph_collector.raw_env" class="md-nav__link">
    raw_env
  </a>
  
    <nav class="md-nav" aria-label="raw_env">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.graph_collector.graph_collector.raw_env.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.graph_collector.graph_collector.raw_env.reward" class="md-nav__link">
    reward()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.graph_collector.graph_collector.env" class="md-nav__link">
    env()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../policies/" class="md-nav__link">
        Policies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../scripts/" class="md-nav__link">
        Scripts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../metrics/" class="md-nav__link">
        Metrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../post_processing/" class="md-nav__link">
        Post Processing
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#collector-2d" class="md-nav__link">
    Collector (2D)
  </a>
  
    <nav class="md-nav" aria-label="Collector (2D)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.collector.collector" class="md-nav__link">
    datadynamics.environments.collector.collector
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.collector.collector.SamplingWrapperEnv" class="md-nav__link">
    SamplingWrapperEnv
  </a>
  
    <nav class="md-nav" aria-label="SamplingWrapperEnv">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.collector.collector.SamplingWrapperEnv.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.collector.collector.SamplingWrapperEnv.reset" class="md-nav__link">
    reset()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.collector.collector.raw_env" class="md-nav__link">
    raw_env
  </a>
  
    <nav class="md-nav" aria-label="raw_env">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.collector.collector.raw_env.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.collector.collector.raw_env.reward" class="md-nav__link">
    reward()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.collector.collector.env" class="md-nav__link">
    env()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#graph-collector" class="md-nav__link">
    Graph Collector
  </a>
  
    <nav class="md-nav" aria-label="Graph Collector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.graph_collector.graph_collector" class="md-nav__link">
    datadynamics.environments.graph_collector.graph_collector
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.graph_collector.graph_collector.raw_env" class="md-nav__link">
    raw_env
  </a>
  
    <nav class="md-nav" aria-label="raw_env">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.graph_collector.graph_collector.raw_env.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.graph_collector.graph_collector.raw_env.reward" class="md-nav__link">
    reward()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datadynamics.environments.graph_collector.graph_collector.env" class="md-nav__link">
    env()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="simulation-environments">Simulation Environments</h1>
<h2 id="collector-2d">Collector (2D)</h2>


<div class="doc doc-object doc-module">


<a id="datadynamics.environments.collector.collector"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="datadynamics.environments.collector.collector.SamplingWrapperEnv" class="doc doc-heading">
        <code>SamplingWrapperEnv</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="datadynamics.environments.collector.collector.raw_env" href="#datadynamics.environments.collector.collector.raw_env">raw_env</a></code></p>

  
      <p>Wrapper that creates point and agent positions from a sampler.</p>


        <details class="quote">
          <summary>Source code in <code>datadynamics/environments/collector/collector.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-948" name="__codelineno-0-948"></a><span class="k">class</span> <span class="nc">SamplingWrapperEnv</span><span class="p">(</span><span class="n">raw_env</span><span class="p">):</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper that creates point and agent positions from a sampler.</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a><span class="sd">    Attributes:</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a><span class="sd">        See AECEnv.</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>        <span class="n">n_agents</span><span class="p">,</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>        <span class="n">max_collect</span><span class="p">,</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>        <span class="n">n_points</span><span class="p">,</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>        <span class="n">sampler</span><span class="o">=</span><span class="k">lambda</span> <span class="n">rng</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">rng</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]),</span> <span class="n">n</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>        <span class="p">),</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>    <span class="p">):</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize wrapper environment.</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a><span class="sd">            n_agents (int): Number of agents to create.</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a><span class="sd">            max_collect (list[int]): List of maximum number of points to</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a><span class="sd">                collect for each agent.</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a><span class="sd">            n_points (int): Number of points to generate.</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a><span class="sd">            sampler (lambda, optional): Lambda function from which n points</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a><span class="sd">                are generated. Should accept an argument `rng` representing a</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a><span class="sd">                random generator (rng, e.g. numpy default_rng) and `n`</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a><span class="sd">                representing number of points to generate. Defaults to a 2D</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a><span class="sd">                standard Normal distribution.</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">seed</span><span class="p">()</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>        <span class="k">assert</span> <span class="n">n_agents</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;n_agents must be greater than 0&quot;</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>        <span class="k">assert</span> <span class="n">n_points</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;n_points must be greater than 0&quot;</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_agents</span> <span class="o">=</span> <span class="n">n_agents</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_points</span> <span class="o">=</span> <span class="n">n_points</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span> <span class="o">=</span> <span class="n">sampler</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>        <span class="n">point_positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_points</span><span class="p">)</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>        <span class="n">point_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">point_positions</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>        <span class="n">init_agent_positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>            <span class="p">[</span><span class="n">point_mean</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_agents</span><span class="p">)]</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>        <span class="p">)</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>            <span class="n">point_positions</span><span class="o">=</span><span class="n">point_positions</span><span class="p">,</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>            <span class="n">init_agent_positions</span><span class="o">=</span><span class="n">init_agent_positions</span><span class="p">,</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>            <span class="n">max_collect</span><span class="o">=</span><span class="n">max_collect</span><span class="p">,</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>        <span class="p">)</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Resets the environment to a starting state.</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a><span class="sd">            seed (int, optional): Random seed to use for resetting. Defaults</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a><span class="sd">                to None.</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a><span class="sd">            return_info (bool, optional): Whether to return infos. Defaults to</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a><span class="sd">                False.</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a><span class="sd">            options (dict, optional): Additional options. Defaults to None.</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a><span class="sd">            dict: Dictionary of observations for each agent. Infos are</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a><span class="sd">                returned if `return_info` is True.</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>            <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">return_info</span><span class="o">=</span><span class="n">return_info</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="datadynamics.environments.collector.collector.SamplingWrapperEnv.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">n_agents</span><span class="p">,</span> <span class="n">max_collect</span><span class="p">,</span> <span class="n">n_points</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="k">lambda</span> <span class="n">rng</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">rng</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]),</span> <span class="n">n</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Initialize wrapper environment.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>n_agents</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Number of agents to create.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>max_collect</code></td>
          <td>
                <code>list[int]</code>
          </td>
          <td><p>List of maximum number of points to
collect for each agent.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>n_points</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Number of points to generate.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>sampler</code></td>
          <td>
                <code>lambda</code>
          </td>
          <td><p>Lambda function from which n points
are generated. Should accept an argument <code>rng</code> representing a
random generator (rng, e.g. numpy default_rng) and <code>n</code>
representing number of points to generate. Defaults to a 2D
standard Normal distribution.</p></td>
          <td>
                <code>lambda rng, n: rng.multivariate_normal(np.array([0, 0]), np.array([[1, 0], [0, 1]]), n)</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datadynamics/environments/collector/collector.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-955">955</a></span>
<span class="normal"><a href="#__codelineno-0-956">956</a></span>
<span class="normal"><a href="#__codelineno-0-957">957</a></span>
<span class="normal"><a href="#__codelineno-0-958">958</a></span>
<span class="normal"><a href="#__codelineno-0-959">959</a></span>
<span class="normal"><a href="#__codelineno-0-960">960</a></span>
<span class="normal"><a href="#__codelineno-0-961">961</a></span>
<span class="normal"><a href="#__codelineno-0-962">962</a></span>
<span class="normal"><a href="#__codelineno-0-963">963</a></span>
<span class="normal"><a href="#__codelineno-0-964">964</a></span>
<span class="normal"><a href="#__codelineno-0-965">965</a></span>
<span class="normal"><a href="#__codelineno-0-966">966</a></span>
<span class="normal"><a href="#__codelineno-0-967">967</a></span>
<span class="normal"><a href="#__codelineno-0-968">968</a></span>
<span class="normal"><a href="#__codelineno-0-969">969</a></span>
<span class="normal"><a href="#__codelineno-0-970">970</a></span>
<span class="normal"><a href="#__codelineno-0-971">971</a></span>
<span class="normal"><a href="#__codelineno-0-972">972</a></span>
<span class="normal"><a href="#__codelineno-0-973">973</a></span>
<span class="normal"><a href="#__codelineno-0-974">974</a></span>
<span class="normal"><a href="#__codelineno-0-975">975</a></span>
<span class="normal"><a href="#__codelineno-0-976">976</a></span>
<span class="normal"><a href="#__codelineno-0-977">977</a></span>
<span class="normal"><a href="#__codelineno-0-978">978</a></span>
<span class="normal"><a href="#__codelineno-0-979">979</a></span>
<span class="normal"><a href="#__codelineno-0-980">980</a></span>
<span class="normal"><a href="#__codelineno-0-981">981</a></span>
<span class="normal"><a href="#__codelineno-0-982">982</a></span>
<span class="normal"><a href="#__codelineno-0-983">983</a></span>
<span class="normal"><a href="#__codelineno-0-984">984</a></span>
<span class="normal"><a href="#__codelineno-0-985">985</a></span>
<span class="normal"><a href="#__codelineno-0-986">986</a></span>
<span class="normal"><a href="#__codelineno-0-987">987</a></span>
<span class="normal"><a href="#__codelineno-0-988">988</a></span>
<span class="normal"><a href="#__codelineno-0-989">989</a></span>
<span class="normal"><a href="#__codelineno-0-990">990</a></span>
<span class="normal"><a href="#__codelineno-0-991">991</a></span>
<span class="normal"><a href="#__codelineno-0-992">992</a></span>
<span class="normal"><a href="#__codelineno-0-993">993</a></span>
<span class="normal"><a href="#__codelineno-0-994">994</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-955" name="__codelineno-0-955"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>    <span class="n">n_agents</span><span class="p">,</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>    <span class="n">max_collect</span><span class="p">,</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>    <span class="n">n_points</span><span class="p">,</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>    <span class="n">sampler</span><span class="o">=</span><span class="k">lambda</span> <span class="n">rng</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">rng</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]),</span> <span class="n">n</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>    <span class="p">),</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a><span class="p">):</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize wrapper environment.</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a><span class="sd">        n_agents (int): Number of agents to create.</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a><span class="sd">        max_collect (list[int]): List of maximum number of points to</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a><span class="sd">            collect for each agent.</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a><span class="sd">        n_points (int): Number of points to generate.</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a><span class="sd">        sampler (lambda, optional): Lambda function from which n points</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a><span class="sd">            are generated. Should accept an argument `rng` representing a</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a><span class="sd">            random generator (rng, e.g. numpy default_rng) and `n`</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a><span class="sd">            representing number of points to generate. Defaults to a 2D</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a><span class="sd">            standard Normal distribution.</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">seed</span><span class="p">()</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>    <span class="k">assert</span> <span class="n">n_agents</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;n_agents must be greater than 0&quot;</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>    <span class="k">assert</span> <span class="n">n_points</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;n_points must be greater than 0&quot;</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">n_agents</span> <span class="o">=</span> <span class="n">n_agents</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">n_points</span> <span class="o">=</span> <span class="n">n_points</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span> <span class="o">=</span> <span class="n">sampler</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>    <span class="n">point_positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_points</span><span class="p">)</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>    <span class="n">point_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">point_positions</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>    <span class="n">init_agent_positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>        <span class="p">[</span><span class="n">point_mean</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_agents</span><span class="p">)]</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>    <span class="p">)</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>        <span class="n">point_positions</span><span class="o">=</span><span class="n">point_positions</span><span class="p">,</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>        <span class="n">init_agent_positions</span><span class="o">=</span><span class="n">init_agent_positions</span><span class="p">,</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>        <span class="n">max_collect</span><span class="o">=</span><span class="n">max_collect</span><span class="p">,</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="datadynamics.environments.collector.collector.SamplingWrapperEnv.reset" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reset</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Resets the environment to a starting state.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>seed</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Random seed to use for resetting. Defaults
to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>return_info</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to return infos. Defaults to
False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>options</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Additional options. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
          </td>
          <td><p>Dictionary of observations for each agent. Infos are
returned if <code>return_info</code> is True.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datadynamics/environments/collector/collector.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-996" name="__codelineno-0-996"></a><span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Resets the environment to a starting state.</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a><span class="sd">        seed (int, optional): Random seed to use for resetting. Defaults</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a><span class="sd">            to None.</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a><span class="sd">        return_info (bool, optional): Whether to return infos. Defaults to</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a><span class="sd">            False.</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a><span class="sd">        options (dict, optional): Additional options. Defaults to None.</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a><span class="sd">        dict: Dictionary of observations for each agent. Infos are</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a><span class="sd">            returned if `return_info` is True.</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>        <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">return_info</span><span class="o">=</span><span class="n">return_info</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="datadynamics.environments.collector.collector.raw_env" class="doc doc-heading">
        <code>raw_env</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="pettingzoo.utils.env.AECEnv">AECEnv</span></code></p>

  
      <p>Raw collector environment.</p>
<p>This environment is based on a 2D plane. Points are given by their (x, y)
coordinates and each agent defines a <code>collector</code> that can move around the
plane to collect points for a reward. Collectors may only move between
points and they always collect the point that they move to.
The cost of moving is defined as the Euclidean distance traveled.
Agents may also cheat and collect an already collected point. Cheating as
well as rewards are defined by a user-given function.</p>


        <details class="quote">
          <summary>Source code in <code>datadynamics/environments/collector/collector.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span>
<span class="normal"><a href="#__codelineno-0-891">891</a></span>
<span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span>
<span class="normal"><a href="#__codelineno-0-902">902</a></span>
<span class="normal"><a href="#__codelineno-0-903">903</a></span>
<span class="normal"><a href="#__codelineno-0-904">904</a></span>
<span class="normal"><a href="#__codelineno-0-905">905</a></span>
<span class="normal"><a href="#__codelineno-0-906">906</a></span>
<span class="normal"><a href="#__codelineno-0-907">907</a></span>
<span class="normal"><a href="#__codelineno-0-908">908</a></span>
<span class="normal"><a href="#__codelineno-0-909">909</a></span>
<span class="normal"><a href="#__codelineno-0-910">910</a></span>
<span class="normal"><a href="#__codelineno-0-911">911</a></span>
<span class="normal"><a href="#__codelineno-0-912">912</a></span>
<span class="normal"><a href="#__codelineno-0-913">913</a></span>
<span class="normal"><a href="#__codelineno-0-914">914</a></span>
<span class="normal"><a href="#__codelineno-0-915">915</a></span>
<span class="normal"><a href="#__codelineno-0-916">916</a></span>
<span class="normal"><a href="#__codelineno-0-917">917</a></span>
<span class="normal"><a href="#__codelineno-0-918">918</a></span>
<span class="normal"><a href="#__codelineno-0-919">919</a></span>
<span class="normal"><a href="#__codelineno-0-920">920</a></span>
<span class="normal"><a href="#__codelineno-0-921">921</a></span>
<span class="normal"><a href="#__codelineno-0-922">922</a></span>
<span class="normal"><a href="#__codelineno-0-923">923</a></span>
<span class="normal"><a href="#__codelineno-0-924">924</a></span>
<span class="normal"><a href="#__codelineno-0-925">925</a></span>
<span class="normal"><a href="#__codelineno-0-926">926</a></span>
<span class="normal"><a href="#__codelineno-0-927">927</a></span>
<span class="normal"><a href="#__codelineno-0-928">928</a></span>
<span class="normal"><a href="#__codelineno-0-929">929</a></span>
<span class="normal"><a href="#__codelineno-0-930">930</a></span>
<span class="normal"><a href="#__codelineno-0-931">931</a></span>
<span class="normal"><a href="#__codelineno-0-932">932</a></span>
<span class="normal"><a href="#__codelineno-0-933">933</a></span>
<span class="normal"><a href="#__codelineno-0-934">934</a></span>
<span class="normal"><a href="#__codelineno-0-935">935</a></span>
<span class="normal"><a href="#__codelineno-0-936">936</a></span>
<span class="normal"><a href="#__codelineno-0-937">937</a></span>
<span class="normal"><a href="#__codelineno-0-938">938</a></span>
<span class="normal"><a href="#__codelineno-0-939">939</a></span>
<span class="normal"><a href="#__codelineno-0-940">940</a></span>
<span class="normal"><a href="#__codelineno-0-941">941</a></span>
<span class="normal"><a href="#__codelineno-0-942">942</a></span>
<span class="normal"><a href="#__codelineno-0-943">943</a></span>
<span class="normal"><a href="#__codelineno-0-944">944</a></span>
<span class="normal"><a href="#__codelineno-0-945">945</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="k">class</span> <span class="nc">raw_env</span><span class="p">(</span><span class="n">AECEnv</span><span class="p">):</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raw collector environment.</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    This environment is based on a 2D plane. Points are given by their (x, y)</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    coordinates and each agent defines a `collector` that can move around the</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">    plane to collect points for a reward. Collectors may only move between</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">    points and they always collect the point that they move to.</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    The cost of moving is defined as the Euclidean distance traveled.</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    Agents may also cheat and collect an already collected point. Cheating as</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">    well as rewards are defined by a user-given function.</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    Attributes:</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        See AECEnv.</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;collector&quot;</span><span class="p">,</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>        <span class="s2">&quot;render_modes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;rgb_array&quot;</span><span class="p">,</span> <span class="s2">&quot;human&quot;</span><span class="p">],</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="s2">&quot;is_parrallelizable&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="s2">&quot;render_fps&quot;</span><span class="p">:</span> <span class="n">FPS</span><span class="p">,</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="p">}</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="n">point_positions</span><span class="p">,</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="n">init_agent_positions</span><span class="p">,</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="n">max_collect</span><span class="p">,</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="n">cheating_cost</span><span class="o">=</span><span class="k">lambda</span> <span class="n">point</span><span class="p">:</span> <span class="mi">500</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="n">collection_reward</span><span class="o">=</span><span class="k">lambda</span> <span class="n">point</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="n">reveal_cheating_cost</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="n">reveal_collection_reward</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="n">render_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="p">):</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize environment.</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">            point_positions (np.ndarray): Positions of collectable points as a</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">                numpy array with shape (n, 2) representing n (x, y)</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">                coordinates.</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">            init_agent_positions (np.ndarray): Initial positions of n agents</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">                as a numpy array with shape (n, 2) representing n (x, y)</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">                coordinates.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">            max_collect (list): List of maximum number of points that each</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">                agent can collect. Index i corresponds to agent i given by</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">                init_agent_positions.</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">            cheating_cost (function, optional): Function that takes a point</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">                and returns the cost of cheating by collecting that point.</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">                Defaults to lambda point: 500 * 0.5.</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">            collection_reward (function, optional): Function that takes a</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">                point and returns the reward of collecting that point.</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">                Defaults to lambda point: 100.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">            reveal_cheating_cost (bool, optional): Whether to reveal the</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">                cheating costs to the agent in observations. Defaults to True.</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">            reveal_collection_reward (bool, optional): Whether to reveal the</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">                collection rewards to the agent in observations. Defaults to</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">                True.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">            seed (int, optional): Seed for random number generator. Defaults</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">                to None.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">            render_mode (str, optional): Render mode. Supported modes are</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">                specified in environment&#39;s metadata[&quot;render_modes&quot;] dict.</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">                Defaults to None.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="k">assert</span> <span class="p">(</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>            <span class="n">render_mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;render_modes&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">render_mode</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="p">),</span> <span class="p">(</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="sa">f</span><span class="s2">&quot;render_mode: </span><span class="si">{</span><span class="n">render_mode</span><span class="si">}</span><span class="s2"> is not supported. &quot;</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>            <span class="sa">f</span><span class="s2">&quot;Supported modes: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;render_modes&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="p">)</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">point_positions</span> <span class="o">=</span> <span class="n">point_positions</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agent_positions</span> <span class="o">=</span> <span class="n">init_agent_positions</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">render_mode</span> <span class="o">=</span> <span class="n">render_mode</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cheating_cost</span> <span class="o">=</span> <span class="n">cheating_cost</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collection_reward</span> <span class="o">=</span> <span class="n">collection_reward</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reveal_cheating_cost</span> <span class="o">=</span> <span class="n">reveal_cheating_cost</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reveal_collection_reward</span> <span class="o">=</span> <span class="n">reveal_collection_reward</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reward_range</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agents</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;agent_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_positions</span><span class="p">))]</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">possible_agents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">[:]</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agent_name_mapping</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="n">agent</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">agent</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="p">}</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_agent_selector</span> <span class="o">=</span> <span class="n">agent_selector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">)</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_collect</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>            <span class="n">agent</span><span class="p">:</span> <span class="n">max_collect</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">agent</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">)</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="p">}</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">translation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_scaling_translation</span><span class="p">(</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">point_positions</span><span class="p">,</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent_positions</span><span class="p">,</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="n">SCREEN_WIDTH</span><span class="p">,</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>            <span class="n">SCREEN_HEIGHT</span><span class="p">,</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="p">)</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">action_spaces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_action_spaces</span><span class="p">(</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">point_positions</span><span class="p">)</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="p">)</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">observation_spaces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_observation_spaces</span><span class="p">(</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">,</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent_positions</span><span class="p">,</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">point_positions</span><span class="p">,</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reveal_cheating_cost</span><span class="p">,</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reveal_collection_reward</span><span class="p">,</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="n">SCREEN_WIDTH</span><span class="p">,</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="n">SCREEN_HEIGHT</span><span class="p">,</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_state_space</span><span class="p">(</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent_positions</span><span class="p">,</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">point_positions</span><span class="p">,</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>            <span class="n">SCREEN_WIDTH</span><span class="p">,</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>            <span class="n">SCREEN_HEIGHT</span><span class="p">,</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="p">)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="c1"># The following are set in reset().</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">total_points_collected</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agent_selection</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">has_reset</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">terminate</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">truncate</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="c1"># Dicts with agent as key.</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cumulative_rewards</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">terminations</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">truncations</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">infos</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cumulative_rewards</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="c1"># pygame</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">surf</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">isopen</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="k">def</span> <span class="nf">_get_boundary_arrays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array_2d</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates arrays with minimum and maximum with same shape as input.</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">            array_2d (np.ndarray): Input array to find minimum and maximum.</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">            shape (_type_): Tuple with shape of output arrays.</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">            np.ndarray: Boundary arrays with minimum and maximum.</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="n">boundary_low</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>            <span class="n">shape</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">array_2d</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="p">)</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="n">boundary_high</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>            <span class="n">shape</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">array_2d</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="p">)</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>        <span class="k">return</span> <span class="n">boundary_low</span><span class="p">,</span> <span class="n">boundary_high</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span class="k">def</span> <span class="nf">_get_obs_state_space</span><span class="p">(</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="n">agent_positions</span><span class="p">,</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="n">point_positions</span><span class="p">,</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="n">reveal_cheating_cost</span><span class="p">,</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="n">reveal_collection_reward</span><span class="p">,</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="n">screen_width</span><span class="p">,</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="n">screen_height</span><span class="p">,</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="p">):</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves global observation/state space.</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">            agent_positions (np.ndarray): Agent positions.</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">            point_positions (np.ndarray): Point positions.</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">            reveal_cheating_cost (bool): Whether to include cheating cost.</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">            reveal_collection_reward (bool): Whether to include collection</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">                rewards.</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">            screen_width (int): Width of display screen.</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">            screen_height (int): Height of display screen.</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">            gymnasium.spaces.Dict: Dict space with global observation/state.</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="n">n_points</span> <span class="o">=</span> <span class="n">point_positions</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="n">point_boundary_low</span><span class="p">,</span> <span class="n">point_boundary_high</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_boundary_arrays</span><span class="p">(</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>            <span class="n">point_positions</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_points</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="p">)</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="n">boundary_low</span><span class="p">,</span> <span class="n">boundary_high</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_boundary_arrays</span><span class="p">(</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">agent_positions</span><span class="p">,</span> <span class="n">point_positions</span><span class="p">)),</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>            <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">agent_positions</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="p">)</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="n">spaces</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>            <span class="s2">&quot;point_positions&quot;</span><span class="p">:</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>                <span class="n">low</span><span class="o">=</span><span class="n">point_boundary_low</span><span class="p">,</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>                <span class="n">high</span><span class="o">=</span><span class="n">point_boundary_high</span><span class="p">,</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>                <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>            <span class="p">),</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>            <span class="s2">&quot;collected&quot;</span><span class="p">:</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>                <span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_points</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>            <span class="p">),</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>            <span class="s2">&quot;collector_positions&quot;</span><span class="p">:</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>                <span class="n">low</span><span class="o">=</span><span class="n">boundary_low</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">boundary_high</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>            <span class="p">),</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>            <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>                <span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>                <span class="n">high</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>                <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">screen_width</span><span class="p">,</span> <span class="n">screen_height</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>                <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>            <span class="p">),</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="p">}</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="k">if</span> <span class="n">reveal_cheating_cost</span><span class="p">:</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>            <span class="n">spaces</span><span class="p">[</span><span class="s2">&quot;cheating_cost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>                <span class="n">low</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_points</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>            <span class="p">)</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="k">if</span> <span class="n">reveal_collection_reward</span><span class="p">:</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>            <span class="n">spaces</span><span class="p">[</span><span class="s2">&quot;collection_reward&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>                <span class="n">low</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_points</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>            <span class="p">)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="n">space</span> <span class="o">=</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span><span class="n">spaces</span><span class="p">)</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="k">return</span> <span class="n">space</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>    <span class="k">def</span> <span class="nf">_get_action_spaces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agents</span><span class="p">,</span> <span class="n">n_points</span><span class="p">):</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves action spaces for all agents.</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="sd">        Each action is a point to collect (by index).</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">            agents (list[str]): List of agent names.</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">            n_points (int): Number of points.</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="sd">            dict: Dictionary of discrete action spaces.</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>        <span class="n">action_spaces</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>            <span class="n">agent</span><span class="p">:</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Discrete</span><span class="p">(</span><span class="n">n_points</span><span class="p">)</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">agents</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>        <span class="p">}</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="k">return</span> <span class="n">action_spaces</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>    <span class="k">def</span> <span class="nf">_get_observation_spaces</span><span class="p">(</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>        <span class="n">agents</span><span class="p">,</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>        <span class="n">agent_positions</span><span class="p">,</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>        <span class="n">point_positions</span><span class="p">,</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="n">reveal_cheating_cost</span><span class="p">,</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>        <span class="n">reveal_collection_reward</span><span class="p">,</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>        <span class="n">screen_width</span><span class="p">,</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>        <span class="n">screen_height</span><span class="p">,</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>    <span class="p">):</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves observation spaces for all agents.</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">        Each observation consist of the point positions, points collected,</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">        agent (incl. inactive) positions, and an image of the environment.</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">        Note:</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">            These are identical for all agents.</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">            agents (list[str]): List of agent names.</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">            agent_positions (np.ndarray): Agent positions.</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">            point_positions (np.ndarray): Point positions.</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">            reveal_cheating_cost (bool): Whether to include cheating cost.</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">            reveal_collection_reward (bool): Whether to include collection</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">                rewards.</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">            screen_width (int): Width of display screen.</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">            screen_height (int): Height of display screen.</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">            dict: Dictionary of observation spaces keyed by agent name.</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="n">observation_spaces</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>            <span class="n">agent</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_obs_state_space</span><span class="p">(</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>                <span class="n">agent_positions</span><span class="p">,</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>                <span class="n">point_positions</span><span class="p">,</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>                <span class="n">reveal_cheating_cost</span><span class="p">,</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>                <span class="n">reveal_collection_reward</span><span class="p">,</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>                <span class="n">screen_width</span><span class="p">,</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>                <span class="n">screen_height</span><span class="p">,</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>            <span class="p">)</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>            <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">agents</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>        <span class="p">}</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>        <span class="k">return</span> <span class="n">observation_spaces</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>    <span class="k">def</span> <span class="nf">_get_state_space</span><span class="p">(</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">agent_positions</span><span class="p">,</span> <span class="n">point_positions</span><span class="p">,</span> <span class="n">screen_width</span><span class="p">,</span> <span class="n">screen_height</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>    <span class="p">):</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves state space.</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">            agent_positions (np.ndarray): Agent positions.</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">            point_positions (np.ndarray): Point positions.</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">            screen_width (int): Width of display screen.</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">            screen_height (int): Height of display screen.</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">            gymnasium.spaces.Dict: State space.</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>        <span class="n">state_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_obs_state_space</span><span class="p">(</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>            <span class="n">agent_positions</span><span class="p">,</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>            <span class="n">point_positions</span><span class="p">,</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>            <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>            <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>            <span class="n">screen_width</span><span class="p">,</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>            <span class="n">screen_height</span><span class="p">,</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>        <span class="p">)</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>        <span class="k">return</span> <span class="n">state_space</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>    <span class="k">def</span> <span class="nf">_get_scaling_translation</span><span class="p">(</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>        <span class="n">point_positions</span><span class="p">,</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>        <span class="n">agent_positions</span><span class="p">,</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>        <span class="n">screen_width</span><span class="p">,</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>        <span class="n">screen_height</span><span class="p">,</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>        <span class="n">relative_padding</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>    <span class="p">):</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns scaling and translation factors for x- and y-axis.</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="sd">        Fits data on display while preserving aspect ratio.</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">            point_positions (np.ndarray): Point positions.</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="sd">            agent_positions (np.ndarray): Agent positions.</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">            screen_width (int): Width of display screen.</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a><span class="sd">            screen_height (int): Height of display screen.</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">            relative_padding (float, optional): Outside padding.</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="sd">                Defaults to 0.1.</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a><span class="sd">            tuple: Tuple of scaling and translation factors for x and y-axis.</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a><span class="sd">                ((scale_x, scale_y), (translate_x, translate_y)).</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">relative_padding</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Relative padding must be in [0,1).&quot;</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>        <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">point_positions</span><span class="p">,</span> <span class="n">agent_positions</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>        <span class="n">minimum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>        <span class="n">maximum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>        <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>            <span class="n">minimum</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>            <span class="n">minimum</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>            <span class="n">maximum</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>            <span class="n">maximum</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>        <span class="p">)</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>        <span class="n">x_range</span> <span class="o">=</span> <span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>        <span class="n">y_range</span> <span class="o">=</span> <span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>        <span class="n">max_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">x_range</span><span class="p">,</span> <span class="n">y_range</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>        <span class="n">upper_x</span> <span class="o">=</span> <span class="n">screen_width</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">relative_padding</span><span class="p">)</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="n">lower_x</span> <span class="o">=</span> <span class="n">screen_width</span> <span class="o">*</span> <span class="n">relative_padding</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>        <span class="n">scaling_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">upper_x</span> <span class="o">-</span> <span class="n">lower_x</span><span class="p">)</span> <span class="o">/</span> <span class="n">max_range</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>        <span class="n">translation_x</span> <span class="o">=</span> <span class="o">-</span><span class="n">x_min</span> <span class="o">*</span> <span class="n">scaling_x</span> <span class="o">+</span> <span class="n">lower_x</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>        <span class="n">upper_y</span> <span class="o">=</span> <span class="n">screen_height</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">relative_padding</span><span class="p">)</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="n">lower_y</span> <span class="o">=</span> <span class="n">screen_height</span> <span class="o">*</span> <span class="n">relative_padding</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>        <span class="n">scaling_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">upper_y</span> <span class="o">-</span> <span class="n">lower_y</span><span class="p">)</span> <span class="o">/</span> <span class="n">max_range</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>        <span class="n">translation_y</span> <span class="o">=</span> <span class="o">-</span><span class="n">y_min</span> <span class="o">*</span> <span class="n">scaling_y</span> <span class="o">+</span> <span class="n">lower_y</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">scaling_x</span><span class="p">,</span> <span class="n">scaling_y</span><span class="p">),</span> <span class="p">(</span><span class="n">translation_x</span><span class="p">,</span> <span class="n">translation_y</span><span class="p">)</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>    <span class="k">def</span> <span class="nf">_scale_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Scale a position using stored scaling and translation factors.</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">            position (tuple): (x, y) tuple of position.</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">            tuple: Scaled (x, y) tuple of position.</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">position</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">translation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">translation</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>    <span class="k">def</span> <span class="nf">_create_collectors</span><span class="p">(</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">agent_positions</span><span class="p">,</span> <span class="n">agents</span><span class="p">,</span> <span class="n">scaling</span><span class="p">,</span> <span class="n">translation</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>    <span class="p">):</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates collector for each agent as a dict.</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="sd">            agent_positions (np.ndarray): Agent positions.</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="sd">            agents (list[str]): List of agent names.</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a><span class="sd">            scaling (tuple): Scaling factors for displaying.</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a><span class="sd">            translation (tuple): Translation factors for displaying.</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a><span class="sd">            dict: Dictionary of collectors keyed by agent name.</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>        <span class="n">collectors</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>            <span class="n">agent</span><span class="p">:</span> <span class="n">Collector</span><span class="p">(</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>                <span class="n">pos</span><span class="o">=</span><span class="n">position</span><span class="p">,</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>                <span class="n">scaling</span><span class="o">=</span><span class="n">scaling</span><span class="p">,</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>                <span class="n">translation</span><span class="o">=</span><span class="n">translation</span><span class="p">,</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>                <span class="nb">id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;collector_</span><span class="si">{</span><span class="n">agent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>            <span class="p">)</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>            <span class="k">for</span> <span class="n">agent</span><span class="p">,</span> <span class="n">position</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">agents</span><span class="p">,</span> <span class="n">agent_positions</span><span class="p">)</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>        <span class="p">}</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>        <span class="k">return</span> <span class="n">collectors</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>    <span class="k">def</span> <span class="nf">_create_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point_positions</span><span class="p">,</span> <span class="n">scaling</span><span class="p">,</span> <span class="n">translation</span><span class="p">):</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates points for all given positions.</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">            point_positions (np.ndarray): Point positions.</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">            scaling (tuple): Scaling factors for displaying.</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="sd">            translation (tuple): Translation factors for displaying.</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">            list[Point]: List of points.</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>        <span class="n">points</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>            <span class="n">Point</span><span class="p">(</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>                <span class="n">pos</span><span class="o">=</span><span class="n">position</span><span class="p">,</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>                <span class="n">scaling</span><span class="o">=</span><span class="n">scaling</span><span class="p">,</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>                <span class="n">translation</span><span class="o">=</span><span class="n">translation</span><span class="p">,</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>                <span class="nb">id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;point_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>            <span class="p">)</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">position</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">point_positions</span><span class="p">)</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>        <span class="p">]</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>        <span class="k">return</span> <span class="n">points</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>    <span class="k">def</span> <span class="nf">_create_image_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surf</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns image array from pygame surface.</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a><span class="sd">            surf (pygame.Surface): Surface to convert to image array.</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="sd">            size (tuple): Tuple of (width, height) to scale surface to.</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">            np.ndarray: Image array.</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>        <span class="n">scaled_surf</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">smoothscale</span><span class="p">(</span><span class="n">surf</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">surfarray</span><span class="o">.</span><span class="n">pixels3d</span><span class="p">(</span><span class="n">scaled_surf</span><span class="p">)),</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>        <span class="p">)</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>    <span class="k">def</span> <span class="nf">reward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collector</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns reward for collecting a given point.</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="sd">        Collecting a point triggers a reward, but if the point has already</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="sd">        been collected, we add a penalty for cheating. The cost of moving</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="sd">        is the Euclidean distance.</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="sd">            collector (Collector): Collector that collected the point.</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="sd">            point (Point): Point that is collected.</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a><span class="sd">            float: Reward.</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>        <span class="n">reward</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">collector</span><span class="o">.</span><span class="n">position</span> <span class="o">-</span> <span class="n">point</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>        <span class="n">reward</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_reward</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>        <span class="k">if</span> <span class="n">point</span><span class="o">.</span><span class="n">is_collected</span><span class="p">():</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>            <span class="n">reward</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cheating_cost</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>        <span class="k">return</span> <span class="n">reward</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>    <span class="k">def</span> <span class="nf">_state</span><span class="p">(</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>        <span class="n">points</span><span class="p">,</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>        <span class="n">collectors</span><span class="p">,</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>        <span class="n">reveal_cheating_cost</span><span class="p">,</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>        <span class="n">reveal_collection_reward</span><span class="p">,</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>    <span class="p">):</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves state of the current global environment.</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a><span class="sd">            points (list[Point]): List of points in the environment.</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="sd">            collectors (dict): Dictionary of collectors.</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a><span class="sd">            reveal_cheating_cost (bool): Whether to reveal cheating cost.</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a><span class="sd">            reveal_collection_reward (bool): Whether to reveal collection</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="sd">                reward.</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a><span class="sd">            dict: Current global state.</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>        <span class="n">state</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>            <span class="s2">&quot;point_positions&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>                <span class="p">[</span><span class="n">point</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>            <span class="p">),</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>            <span class="s2">&quot;collected&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>                <span class="p">[</span><span class="n">point</span><span class="o">.</span><span class="n">get_collect_counter</span><span class="p">()</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>            <span class="p">),</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>            <span class="s2">&quot;collector_positions&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>                <span class="p">[</span><span class="n">collector</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">collector</span> <span class="ow">in</span> <span class="n">collectors</span><span class="o">.</span><span class="n">values</span><span class="p">()],</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>                <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>            <span class="p">),</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>            <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">render_mode</span><span class="o">=</span><span class="s2">&quot;rgb_array&quot;</span><span class="p">),</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>        <span class="p">}</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>        <span class="k">if</span> <span class="n">reveal_cheating_cost</span><span class="p">:</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>            <span class="n">state</span><span class="p">[</span><span class="s2">&quot;cheating_cost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cheating_cost</span><span class="p">(</span><span class="n">point</span><span class="p">)</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">],</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>                <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>            <span class="p">)</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>        <span class="k">if</span> <span class="n">reveal_collection_reward</span><span class="p">:</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>            <span class="n">state</span><span class="p">[</span><span class="s2">&quot;collection_reward&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_reward</span><span class="p">(</span><span class="n">point</span><span class="p">)</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">],</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>                <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>            <span class="p">)</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>        <span class="k">return</span> <span class="n">state</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>    <span class="k">def</span> <span class="nf">observe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">):</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>        <span class="c1"># FIXME: Warning for api_test /Users/lfwa/Library/Caches/pypoetry/</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>        <span class="c1"># virtualenvs/collector-gjPrMD7k-py3.10/lib/python3.10/site-packages/</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>        <span class="c1"># pettingzoo/test/api_test.py:60: UserWarning: Observation is not</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>        <span class="c1"># NumPy array</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>        <span class="c1"># warnings.warn(&quot;Observation is not NumPy array&quot;)</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">(</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">,</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">,</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reveal_cheating_cost</span><span class="p">,</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reveal_collection_reward</span><span class="p">,</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>        <span class="p">)</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>    <span class="k">def</span> <span class="nf">state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>        <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">possible_agents</span><span class="p">[:]</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_agent_selector</span><span class="o">.</span><span class="n">reinit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">)</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agent_selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent_selector</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_collectors</span><span class="p">(</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent_positions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">translation</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>        <span class="p">)</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_points</span><span class="p">(</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">point_positions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">translation</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>        <span class="p">)</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">total_points_collected</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">has_reset</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">terminate</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">truncate</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cumulative_rewards</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">terminations</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">truncations</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">infos</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cumulative_rewards</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>        <span class="n">observations</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_info</span><span class="p">:</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>            <span class="k">return</span> <span class="n">observations</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>            <span class="k">return</span> <span class="n">observations</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">infos</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>        <span class="k">assert</span> <span class="p">(</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">has_reset</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>        <span class="p">),</span> <span class="s2">&quot;Environment has not been reset yet. Call env.reset() first.&quot;</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>        <span class="n">agent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_selection</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminations</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">truncations</span><span class="p">[</span><span class="n">agent</span><span class="p">]:</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_was_dead_step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>            <span class="c1"># Guard against first agent dying first since _was_dead_step()</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>            <span class="c1"># does not update agent_selection when that happens.</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_selection</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">:</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agent_selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent_selector</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>            <span class="k">return</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_space</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>            <span class="ow">and</span> <span class="n">action</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>        <span class="p">):</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Action </span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2"> is invalid for agent </span><span class="si">{</span><span class="n">agent</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>        <span class="k">if</span> <span class="n">action</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>            <span class="n">point_to_collect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">action</span><span class="p">]</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>            <span class="n">collector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>            <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reward</span><span class="p">(</span><span class="n">collector</span><span class="p">,</span> <span class="n">point_to_collect</span><span class="p">)</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>            <span class="c1"># Move collector to point position.</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>            <span class="n">collector</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">point_to_collect</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>            <span class="c1"># Only collect point after reward has been calculated.</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>            <span class="n">collector</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">point_to_collect</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_points_collected</span><span class="p">)</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">total_points_collected</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>            <span class="n">reward</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>        <span class="c1"># Update termination and truncation for agent.</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span><span class="o">.</span><span class="n">total_points_collected</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>            <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_collect</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>        <span class="p">):</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">terminations</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">terminate</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">terminations</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">truncate</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">truncations</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span> <span class="o">=</span> <span class="n">reward</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cumulative_rewards</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span> <span class="o">+=</span> <span class="n">reward</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>        <span class="c1"># Cumulative reward since agent has last acted.</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cumulative_rewards</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_accumulate_rewards</span><span class="p">()</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agent_selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent_selector</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_mode</span> <span class="o">==</span> <span class="s2">&quot;human&quot;</span><span class="p">:</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>        <span class="k">assert</span> <span class="p">(</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">has_reset</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>        <span class="p">),</span> <span class="s2">&quot;Environment has not been reset yet. Call env.reset() first.&quot;</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>            <span class="n">gymnasium</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>                <span class="sa">f</span><span class="s2">&quot;No render mode specified, skipping render. Please &quot;</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>                <span class="s2">&quot;specify render_mode as one of the supported modes &quot;</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;render_modes&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> at initialization.&quot;</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>            <span class="p">)</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">render_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">render_mode</span><span class="p">)</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>    <span class="k">def</span> <span class="nf">_render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">render_mode</span><span class="p">):</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Renders the environment.</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a><span class="sd">            render_mode (str): One of the supported render modes.</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a><span class="sd">            np.ndarray or None: Returns the rendered image if render_mode is</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a><span class="sd">                `rgb_array`, otherwise returns None.</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>        <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">render_mode</span> <span class="o">==</span> <span class="s2">&quot;human&quot;</span><span class="p">:</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>            <span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>            <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">(</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>                <span class="p">(</span><span class="n">SCREEN_WIDTH</span><span class="p">,</span> <span class="n">SCREEN_HEIGHT</span><span class="p">)</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>            <span class="p">)</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clock</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">surf</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">Surface</span><span class="p">((</span><span class="n">SCREEN_WIDTH</span><span class="p">,</span> <span class="n">SCREEN_HEIGHT</span><span class="p">))</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>        <span class="c1"># Add white background.</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_render_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">POINT_SIZE</span><span class="p">)</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_render_paths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">,</span> <span class="n">PATH_SIZE</span><span class="p">)</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_render_collectors</span><span class="p">(</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">,</span> <span class="n">COLLECTOR_LEN</span><span class="p">,</span> <span class="n">COLLECTOR_SIZE</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>        <span class="p">)</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>        <span class="c1"># Flip y-axis since pygame has origin at top left.</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">surf</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">,</span> <span class="n">flip_x</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">flip_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_render_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">)</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>        <span class="k">if</span> <span class="n">render_mode</span> <span class="o">==</span> <span class="s2">&quot;human&quot;</span><span class="p">:</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>            <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">pump</span><span class="p">()</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;render_fps&quot;</span><span class="p">])</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>            <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>        <span class="k">elif</span> <span class="n">render_mode</span> <span class="o">==</span> <span class="s2">&quot;rgb_array&quot;</span><span class="p">:</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_image_array</span><span class="p">(</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">,</span> <span class="p">(</span><span class="n">SCREEN_WIDTH</span><span class="p">,</span> <span class="n">SCREEN_HEIGHT</span><span class="p">)</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>            <span class="p">)</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>    <span class="k">def</span> <span class="nf">_render_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surf</span><span class="p">):</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Renders information text, e.g. stats about environment and actions.</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a><span class="sd">            surf (pygame.Surface): Surface to render text on.</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>        <span class="p">(</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>            <span class="n">stats</span><span class="p">,</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>            <span class="n">overall_total_points_collected</span><span class="p">,</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>            <span class="n">overall_unique_points_collected</span><span class="p">,</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>            <span class="n">overall_cheated</span><span class="p">,</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_stats</span><span class="p">()</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>        <span class="n">total_reward</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cumulative_rewards</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>        <span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">get_default_font</span><span class="p">(),</span> <span class="n">FONT_SIZE</span><span class="p">)</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>        <span class="n">text1</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>            <span class="p">(</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>                <span class="sa">f</span><span class="s2">&quot;Iteration: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iteration</span><span class="si">}</span><span class="s2"> | &quot;</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>                <span class="sa">f</span><span class="s2">&quot;Total points collected: </span><span class="si">{</span><span class="n">overall_total_points_collected</span><span class="si">}</span><span class="s2"> | &quot;</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>                <span class="s2">&quot;Unique points collected: &quot;</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">overall_unique_points_collected</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span><span class="si">}</span><span class="s2"> | &quot;</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>                <span class="sa">f</span><span class="s2">&quot;Cheated: </span><span class="si">{</span><span class="n">overall_cheated</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>            <span class="p">),</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>            <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>        <span class="p">)</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>        <span class="n">text2</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>            <span class="sa">f</span><span class="s2">&quot;Total cumulative reward: </span><span class="si">{</span><span class="n">total_reward</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>            <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>        <span class="p">)</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>        <span class="n">surf</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>        <span class="n">surf</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">text2</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>    <span class="k">def</span> <span class="nf">_get_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves stats for all collectors.</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a><span class="sd">            tuple: Tuple of stats.</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>        <span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>        <span class="n">overall_total_points_collected</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>        <span class="n">overall_unique_points_collected</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>        <span class="n">overall_cheated</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>        <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">:</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>            <span class="n">collector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>            <span class="n">stats</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>                <span class="s2">&quot;total_points_collected&quot;</span><span class="p">:</span> <span class="n">collector</span><span class="o">.</span><span class="n">total_points_collected</span><span class="p">,</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>                <span class="s2">&quot;unique_points_collected&quot;</span><span class="p">:</span> <span class="n">collector</span><span class="o">.</span><span class="n">unique_points_collected</span><span class="p">,</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>                <span class="s2">&quot;cheated&quot;</span><span class="p">:</span> <span class="n">collector</span><span class="o">.</span><span class="n">cheated</span><span class="p">,</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>            <span class="p">}</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>            <span class="n">overall_total_points_collected</span> <span class="o">+=</span> <span class="n">collector</span><span class="o">.</span><span class="n">total_points_collected</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>            <span class="n">overall_unique_points_collected</span> <span class="o">+=</span> <span class="p">(</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>                <span class="n">collector</span><span class="o">.</span><span class="n">unique_points_collected</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>            <span class="p">)</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>            <span class="n">overall_cheated</span> <span class="o">+=</span> <span class="n">collector</span><span class="o">.</span><span class="n">cheated</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>        <span class="k">return</span> <span class="p">(</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>            <span class="n">stats</span><span class="p">,</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>            <span class="n">overall_total_points_collected</span><span class="p">,</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>            <span class="n">overall_unique_points_collected</span><span class="p">,</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>            <span class="n">overall_cheated</span><span class="p">,</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>        <span class="p">)</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>    <span class="k">def</span> <span class="nf">_render_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surf</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">point_size</span><span class="p">):</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Renders all points as circles.</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a><span class="sd">        Points are colored according to their collector as a pie chart.</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a><span class="sd">            surf (pygame.Surface): Surface to render points on.</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a><span class="sd">            points (list[Points]): List of points to render.</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a><span class="sd">            point_size (int): Render size of points.</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">scaled_position</span> <span class="o">-</span> <span class="p">(</span><span class="n">point_size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>            <span class="n">bounding_box</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">point_size</span><span class="p">,</span> <span class="n">point_size</span><span class="p">)</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>            <span class="n">total_collections</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">get_collect_counter</span><span class="p">()</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>            <span class="n">start_angle</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>            <span class="k">if</span> <span class="n">total_collections</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>                <span class="n">pygame</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>                    <span class="n">surf</span><span class="p">,</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>                    <span class="n">point</span><span class="o">.</span><span class="n">color</span><span class="p">,</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>                    <span class="nb">tuple</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">scaled_position</span><span class="p">),</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>                    <span class="n">point_size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>                <span class="p">)</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>                <span class="k">for</span> <span class="p">(</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>                    <span class="n">collector_id</span><span class="p">,</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>                    <span class="n">collections</span><span class="p">,</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>                <span class="p">)</span> <span class="ow">in</span> <span class="n">point</span><span class="o">.</span><span class="n">collector_tracker</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>                    <span class="k">if</span> <span class="n">collections</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>                        <span class="k">continue</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>                    <span class="n">arc_length</span> <span class="o">=</span> <span class="n">collections</span> <span class="o">/</span> <span class="n">total_collections</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>                    <span class="n">pygame</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>                        <span class="n">surf</span><span class="p">,</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="n">collector_id</span><span class="p">[</span><span class="mi">10</span><span class="p">:]]</span><span class="o">.</span><span class="n">color</span><span class="p">,</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>                        <span class="n">bounding_box</span><span class="p">,</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>                        <span class="n">start_angle</span><span class="p">,</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>                        <span class="n">start_angle</span> <span class="o">+</span> <span class="n">arc_length</span><span class="p">,</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>                        <span class="n">point_size</span><span class="p">,</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>                    <span class="p">)</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>                    <span class="n">start_angle</span> <span class="o">+=</span> <span class="n">arc_length</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>    <span class="k">def</span> <span class="nf">_render_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surf</span><span class="p">,</span> <span class="n">collectors</span><span class="p">,</span> <span class="n">path_size</span><span class="p">):</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Renders paths taken by collectors.</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a><span class="sd">        Colors are assigned to paths based on the collector that took it.</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a><span class="sd">        If paths overlap then they are colored in segments.</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a><span class="sd">            surf (pygame.Surface): Surface to render paths on.</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a><span class="sd">            collectors (dict): Dict of collectors.</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a><span class="sd">            path_size (int): Render size of paths.</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>        <span class="n">path_pairs</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>        <span class="k">for</span> <span class="n">collector</span> <span class="ow">in</span> <span class="n">collectors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>            <span class="n">path_pos_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">collector</span><span class="o">.</span><span class="n">path_positions</span><span class="p">)</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>            <span class="k">if</span> <span class="n">path_pos_len</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>                <span class="k">continue</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">path_pos_len</span><span class="p">):</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>                <span class="n">key</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>                    <span class="nb">tuple</span><span class="p">(</span><span class="n">collector</span><span class="o">.</span><span class="n">path_positions</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]),</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>                    <span class="nb">tuple</span><span class="p">(</span><span class="n">collector</span><span class="o">.</span><span class="n">path_positions</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>                <span class="p">)</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>                <span class="n">reverse_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>                <span class="c1"># We should not care whether it is (a, b) or (b, a).</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">path_pairs</span><span class="p">:</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>                    <span class="n">path_pairs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">collector</span><span class="p">]</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>                <span class="k">elif</span> <span class="n">reverse_key</span> <span class="ow">in</span> <span class="n">path_pairs</span><span class="p">:</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>                    <span class="n">path_pairs</span><span class="p">[</span><span class="n">reverse_key</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">collector</span><span class="p">]</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>                    <span class="n">path_pairs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">collector</span><span class="p">]</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>        <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">collectors</span> <span class="ow">in</span> <span class="n">path_pairs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>            <span class="n">total_collectors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">collectors</span><span class="p">)</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>            <span class="n">prev_x</span><span class="p">,</span> <span class="n">prev_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_position</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_position</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>            <span class="n">segment_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">prev_x</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_collectors</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>            <span class="n">segment_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">prev_y</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_collectors</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>            <span class="k">for</span> <span class="n">collector</span> <span class="ow">in</span> <span class="n">collectors</span><span class="p">:</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>                <span class="n">pygame</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>                    <span class="n">surf</span><span class="p">,</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>                    <span class="n">collector</span><span class="o">.</span><span class="n">color</span><span class="p">,</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>                    <span class="p">(</span><span class="n">prev_x</span><span class="p">,</span> <span class="n">prev_y</span><span class="p">),</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>                    <span class="p">(</span><span class="n">prev_x</span> <span class="o">+</span> <span class="n">segment_x</span><span class="p">,</span> <span class="n">prev_y</span> <span class="o">+</span> <span class="n">segment_y</span><span class="p">),</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>                    <span class="n">path_size</span><span class="p">,</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>                <span class="p">)</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>                <span class="n">prev_x</span> <span class="o">+=</span> <span class="n">segment_x</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>                <span class="n">prev_y</span> <span class="o">+=</span> <span class="n">segment_y</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>    <span class="k">def</span> <span class="nf">_render_collectors</span><span class="p">(</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">surf</span><span class="p">,</span> <span class="n">collectors</span><span class="p">,</span> <span class="n">collector_len</span><span class="p">,</span> <span class="n">collector_size</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>    <span class="p">):</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Renders all collectors as crosses.</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a><span class="sd">        Collectors are rotated when stacked to avoid overlapping.</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a><span class="sd">        Black borders are added to crosses.</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a><span class="sd">            surf (pygame.Surface): Surface to render collectors on.</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a><span class="sd">            collectors (dict): Dict of collectors.</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a><span class="sd">            collector_len (int): Length of collector cross.</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a><span class="sd">            collector_size (int): Size of collector cross.</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>        <span class="k">for</span> <span class="n">position</span><span class="p">,</span> <span class="n">colls</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">(</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>            <span class="n">collectors</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="k">lambda</span> <span class="n">col</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>        <span class="p">):</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>            <span class="n">colls</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">colls</span><span class="p">)</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>            <span class="n">position</span> <span class="o">=</span> <span class="n">colls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scaled_position</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>            <span class="n">total_collectors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">colls</span><span class="p">)</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>            <span class="n">shift_increment</span> <span class="o">=</span> <span class="n">collector_len</span> <span class="o">/</span> <span class="n">total_collectors</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>            <span class="n">shift</span> <span class="o">=</span> <span class="n">collector_len</span> <span class="o">/</span> <span class="mi">2</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">collector</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colls</span><span class="p">):</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>                <span class="n">cross_rotate_shift</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">shift_increment</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>                <span class="c1"># Add black border to cross.</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>                <span class="n">border_size</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">collector_size</span> <span class="o">*</span> <span class="mf">1.7</span><span class="p">)</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>                <span class="n">pygame</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>                    <span class="n">surf</span><span class="p">,</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>                    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>                    <span class="n">start_pos</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">cross_rotate_shift</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>                    <span class="p">),</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>                    <span class="n">end_pos</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift</span> <span class="o">-</span> <span class="n">cross_rotate_shift</span><span class="p">,</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift</span><span class="p">,</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>                    <span class="p">),</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>                    <span class="n">width</span><span class="o">=</span><span class="n">border_size</span><span class="p">,</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>                <span class="p">)</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>                <span class="n">pygame</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>                    <span class="n">surf</span><span class="p">,</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>                    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>                    <span class="n">start_pos</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift</span><span class="p">,</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">cross_rotate_shift</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>                    <span class="p">),</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>                    <span class="n">end_pos</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift</span> <span class="o">-</span> <span class="n">cross_rotate_shift</span><span class="p">,</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>                    <span class="p">),</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>                    <span class="n">width</span><span class="o">=</span><span class="n">border_size</span><span class="p">,</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a>                <span class="p">)</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>                <span class="c1"># Draw cross.</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>                <span class="n">pygame</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>                    <span class="n">surf</span><span class="p">,</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>                    <span class="n">collector</span><span class="o">.</span><span class="n">color</span><span class="p">,</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>                    <span class="n">start_pos</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">cross_rotate_shift</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>                    <span class="p">),</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>                    <span class="n">end_pos</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift</span> <span class="o">-</span> <span class="n">cross_rotate_shift</span><span class="p">,</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift</span><span class="p">,</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>                    <span class="p">),</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>                    <span class="n">width</span><span class="o">=</span><span class="n">collector_size</span><span class="p">,</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>                <span class="p">)</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>                <span class="n">pygame</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>                    <span class="n">surf</span><span class="p">,</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>                    <span class="n">collector</span><span class="o">.</span><span class="n">color</span><span class="p">,</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>                    <span class="n">start_pos</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift</span><span class="p">,</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">cross_rotate_shift</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>                    <span class="p">),</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>                    <span class="n">end_pos</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift</span> <span class="o">-</span> <span class="n">cross_rotate_shift</span><span class="p">,</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>                    <span class="p">),</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>                    <span class="n">width</span><span class="o">=</span><span class="n">collector_size</span><span class="p">,</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>                <span class="p">)</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>    <span class="k">def</span> <span class="nf">observation_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">):</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_spaces</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>    <span class="k">def</span> <span class="nf">action_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">):</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_spaces</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>    <span class="k">def</span> <span class="nf">seed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">seeding</span><span class="o">.</span><span class="n">np_random</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>        <span class="k">return</span> <span class="p">[</span><span class="n">seed</span><span class="p">]</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>            <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">isopen</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>            <span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="datadynamics.environments.collector.collector.raw_env.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">point_positions</span><span class="p">,</span> <span class="n">init_agent_positions</span><span class="p">,</span> <span class="n">max_collect</span><span class="p">,</span> <span class="n">cheating_cost</span><span class="o">=</span><span class="k">lambda</span> <span class="n">point</span><span class="p">:</span> <span class="mi">500</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">collection_reward</span><span class="o">=</span><span class="k">lambda</span> <span class="n">point</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="n">reveal_cheating_cost</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reveal_collection_reward</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">render_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Initialize environment.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>point_positions</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>Positions of collectable points as a
numpy array with shape (n, 2) representing n (x, y)
coordinates.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>init_agent_positions</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>Initial positions of n agents
as a numpy array with shape (n, 2) representing n (x, y)
coordinates.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>max_collect</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>List of maximum number of points that each
agent can collect. Index i corresponds to agent i given by
init_agent_positions.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>cheating_cost</code></td>
          <td>
                <code>function</code>
          </td>
          <td><p>Function that takes a point
and returns the cost of cheating by collecting that point.
Defaults to lambda point: 500 * 0.5.</p></td>
          <td>
                <code>lambda point: 500 * 0.5</code>
          </td>
        </tr>
        <tr>
          <td><code>collection_reward</code></td>
          <td>
                <code>function</code>
          </td>
          <td><p>Function that takes a
point and returns the reward of collecting that point.
Defaults to lambda point: 100.</p></td>
          <td>
                <code>lambda point: 100</code>
          </td>
        </tr>
        <tr>
          <td><code>reveal_cheating_cost</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to reveal the
cheating costs to the agent in observations. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>reveal_collection_reward</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to reveal the
collection rewards to the agent in observations. Defaults to
True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>seed</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Seed for random number generator. Defaults
to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>render_mode</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Render mode. Supported modes are
specified in environment's metadata["render_modes"] dict.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datadynamics/environments/collector/collector.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="n">point_positions</span><span class="p">,</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="n">init_agent_positions</span><span class="p">,</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="n">max_collect</span><span class="p">,</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="n">cheating_cost</span><span class="o">=</span><span class="k">lambda</span> <span class="n">point</span><span class="p">:</span> <span class="mi">500</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="n">collection_reward</span><span class="o">=</span><span class="k">lambda</span> <span class="n">point</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="n">reveal_cheating_cost</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="n">reveal_collection_reward</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="n">render_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="p">):</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize environment.</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        point_positions (np.ndarray): Positions of collectable points as a</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">            numpy array with shape (n, 2) representing n (x, y)</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">            coordinates.</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">        init_agent_positions (np.ndarray): Initial positions of n agents</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">            as a numpy array with shape (n, 2) representing n (x, y)</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">            coordinates.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        max_collect (list): List of maximum number of points that each</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">            agent can collect. Index i corresponds to agent i given by</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">            init_agent_positions.</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        cheating_cost (function, optional): Function that takes a point</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">            and returns the cost of cheating by collecting that point.</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">            Defaults to lambda point: 500 * 0.5.</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        collection_reward (function, optional): Function that takes a</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">            point and returns the reward of collecting that point.</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">            Defaults to lambda point: 100.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        reveal_cheating_cost (bool, optional): Whether to reveal the</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">            cheating costs to the agent in observations. Defaults to True.</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        reveal_collection_reward (bool, optional): Whether to reveal the</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">            collection rewards to the agent in observations. Defaults to</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">            True.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        seed (int, optional): Seed for random number generator. Defaults</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">            to None.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">        render_mode (str, optional): Render mode. Supported modes are</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">            specified in environment&#39;s metadata[&quot;render_modes&quot;] dict.</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">            Defaults to None.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="k">assert</span> <span class="p">(</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="n">render_mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;render_modes&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">render_mode</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="p">),</span> <span class="p">(</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="sa">f</span><span class="s2">&quot;render_mode: </span><span class="si">{</span><span class="n">render_mode</span><span class="si">}</span><span class="s2"> is not supported. &quot;</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="sa">f</span><span class="s2">&quot;Supported modes: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;render_modes&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="p">)</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">point_positions</span> <span class="o">=</span> <span class="n">point_positions</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">agent_positions</span> <span class="o">=</span> <span class="n">init_agent_positions</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">render_mode</span> <span class="o">=</span> <span class="n">render_mode</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">cheating_cost</span> <span class="o">=</span> <span class="n">cheating_cost</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">collection_reward</span> <span class="o">=</span> <span class="n">collection_reward</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">reveal_cheating_cost</span> <span class="o">=</span> <span class="n">reveal_cheating_cost</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">reveal_collection_reward</span> <span class="o">=</span> <span class="n">reveal_collection_reward</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">reward_range</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">agents</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;agent_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_positions</span><span class="p">))]</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">possible_agents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">[:]</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">agent_name_mapping</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="n">agent</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">agent</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="p">}</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_agent_selector</span> <span class="o">=</span> <span class="n">agent_selector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">)</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">max_collect</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="n">agent</span><span class="p">:</span> <span class="n">max_collect</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">agent</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">)</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="p">}</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">translation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_scaling_translation</span><span class="p">(</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">point_positions</span><span class="p">,</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agent_positions</span><span class="p">,</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="n">SCREEN_WIDTH</span><span class="p">,</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="n">SCREEN_HEIGHT</span><span class="p">,</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="p">)</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">action_spaces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_action_spaces</span><span class="p">(</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">point_positions</span><span class="p">)</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="p">)</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">observation_spaces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_observation_spaces</span><span class="p">(</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">,</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agent_positions</span><span class="p">,</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">point_positions</span><span class="p">,</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reveal_cheating_cost</span><span class="p">,</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reveal_collection_reward</span><span class="p">,</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="n">SCREEN_WIDTH</span><span class="p">,</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="n">SCREEN_HEIGHT</span><span class="p">,</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">state_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_state_space</span><span class="p">(</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agent_positions</span><span class="p">,</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">point_positions</span><span class="p">,</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="n">SCREEN_WIDTH</span><span class="p">,</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="n">SCREEN_HEIGHT</span><span class="p">,</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="p">)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="c1"># The following are set in reset().</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_points_collected</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">agent_selection</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">has_reset</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">terminate</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">truncate</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>    <span class="c1"># Dicts with agent as key.</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_cumulative_rewards</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">terminations</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">truncations</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">infos</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">cumulative_rewards</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="c1"># pygame</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">surf</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">isopen</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="datadynamics.environments.collector.collector.raw_env.reward" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reward</span><span class="p">(</span><span class="n">collector</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Returns reward for collecting a given point.</p>
<p>Collecting a point triggers a reward, but if the point has already
been collected, we add a penalty for cheating. The cost of moving
is the Euclidean distance.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>collector</code></td>
          <td>
                <code><span title="datadynamics.utils.objects.Collector">Collector</span></code>
          </td>
          <td><p>Collector that collected the point.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>point</code></td>
          <td>
                <code><span title="datadynamics.utils.objects.Point">Point</span></code>
          </td>
          <td><p>Point that is collected.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>float</code></td>          <td>
          </td>
          <td><p>Reward.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datadynamics/environments/collector/collector.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="k">def</span> <span class="nf">reward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collector</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns reward for collecting a given point.</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="sd">    Collecting a point triggers a reward, but if the point has already</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="sd">    been collected, we add a penalty for cheating. The cost of moving</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="sd">    is the Euclidean distance.</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="sd">        collector (Collector): Collector that collected the point.</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="sd">        point (Point): Point that is collected.</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a><span class="sd">        float: Reward.</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>    <span class="n">reward</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">collector</span><span class="o">.</span><span class="n">position</span> <span class="o">-</span> <span class="n">point</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>    <span class="n">reward</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_reward</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>    <span class="k">if</span> <span class="n">point</span><span class="o">.</span><span class="n">is_collected</span><span class="p">():</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>        <span class="n">reward</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cheating_cost</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>    <span class="k">return</span> <span class="n">reward</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="datadynamics.environments.collector.collector.env" class="doc doc-heading">
<code class="highlight language-python"><span class="n">env</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Creates a collector environment.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td><p>pettingzoo.utils.env.AECEnv: Created environment.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datadynamics/environments/collector/collector.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="k">def</span> <span class="nf">env</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a collector environment.</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        pettingzoo.utils.env.AECEnv: Created environment.</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="k">if</span> <span class="s2">&quot;n_points&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>        <span class="n">env</span> <span class="o">=</span> <span class="n">SamplingWrapperEnv</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>        <span class="n">env</span> <span class="o">=</span> <span class="n">raw_env</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="k">return</span> <span class="n">env</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="graph-collector">Graph Collector</h2>


<div class="doc doc-object doc-module">


<a id="datadynamics.environments.graph_collector.graph_collector"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="datadynamics.environments.graph_collector.graph_collector.raw_env" class="doc doc-heading">
        <code>raw_env</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="pettingzoo.utils.env.AECEnv">AECEnv</span></code></p>

  
      <p>Raw graph collector environment.</p>
<p>This environment is based on a weighted (possible directed) graph using
networkx. The graph represents the environment structure and may define
obstacles by creating nodes with e.g. no connecting edges as well as
define collectable points. The weight of each edge defines the cost of
traversing that edge.
Agents can move around the graph by traversing edges and collect defined
points for a reward. Agents can also cheat by collecting points that have
already been collected. Cheating as well as rewards are
defined by a user-given function.</p>


        <details class="quote">
          <summary>Source code in <code>datadynamics/environments/graph_collector/graph_collector.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-33">  33</a></span>
<span class="normal"><a href="#__codelineno-0-34">  34</a></span>
<span class="normal"><a href="#__codelineno-0-35">  35</a></span>
<span class="normal"><a href="#__codelineno-0-36">  36</a></span>
<span class="normal"><a href="#__codelineno-0-37">  37</a></span>
<span class="normal"><a href="#__codelineno-0-38">  38</a></span>
<span class="normal"><a href="#__codelineno-0-39">  39</a></span>
<span class="normal"><a href="#__codelineno-0-40">  40</a></span>
<span class="normal"><a href="#__codelineno-0-41">  41</a></span>
<span class="normal"><a href="#__codelineno-0-42">  42</a></span>
<span class="normal"><a href="#__codelineno-0-43">  43</a></span>
<span class="normal"><a href="#__codelineno-0-44">  44</a></span>
<span class="normal"><a href="#__codelineno-0-45">  45</a></span>
<span class="normal"><a href="#__codelineno-0-46">  46</a></span>
<span class="normal"><a href="#__codelineno-0-47">  47</a></span>
<span class="normal"><a href="#__codelineno-0-48">  48</a></span>
<span class="normal"><a href="#__codelineno-0-49">  49</a></span>
<span class="normal"><a href="#__codelineno-0-50">  50</a></span>
<span class="normal"><a href="#__codelineno-0-51">  51</a></span>
<span class="normal"><a href="#__codelineno-0-52">  52</a></span>
<span class="normal"><a href="#__codelineno-0-53">  53</a></span>
<span class="normal"><a href="#__codelineno-0-54">  54</a></span>
<span class="normal"><a href="#__codelineno-0-55">  55</a></span>
<span class="normal"><a href="#__codelineno-0-56">  56</a></span>
<span class="normal"><a href="#__codelineno-0-57">  57</a></span>
<span class="normal"><a href="#__codelineno-0-58">  58</a></span>
<span class="normal"><a href="#__codelineno-0-59">  59</a></span>
<span class="normal"><a href="#__codelineno-0-60">  60</a></span>
<span class="normal"><a href="#__codelineno-0-61">  61</a></span>
<span class="normal"><a href="#__codelineno-0-62">  62</a></span>
<span class="normal"><a href="#__codelineno-0-63">  63</a></span>
<span class="normal"><a href="#__codelineno-0-64">  64</a></span>
<span class="normal"><a href="#__codelineno-0-65">  65</a></span>
<span class="normal"><a href="#__codelineno-0-66">  66</a></span>
<span class="normal"><a href="#__codelineno-0-67">  67</a></span>
<span class="normal"><a href="#__codelineno-0-68">  68</a></span>
<span class="normal"><a href="#__codelineno-0-69">  69</a></span>
<span class="normal"><a href="#__codelineno-0-70">  70</a></span>
<span class="normal"><a href="#__codelineno-0-71">  71</a></span>
<span class="normal"><a href="#__codelineno-0-72">  72</a></span>
<span class="normal"><a href="#__codelineno-0-73">  73</a></span>
<span class="normal"><a href="#__codelineno-0-74">  74</a></span>
<span class="normal"><a href="#__codelineno-0-75">  75</a></span>
<span class="normal"><a href="#__codelineno-0-76">  76</a></span>
<span class="normal"><a href="#__codelineno-0-77">  77</a></span>
<span class="normal"><a href="#__codelineno-0-78">  78</a></span>
<span class="normal"><a href="#__codelineno-0-79">  79</a></span>
<span class="normal"><a href="#__codelineno-0-80">  80</a></span>
<span class="normal"><a href="#__codelineno-0-81">  81</a></span>
<span class="normal"><a href="#__codelineno-0-82">  82</a></span>
<span class="normal"><a href="#__codelineno-0-83">  83</a></span>
<span class="normal"><a href="#__codelineno-0-84">  84</a></span>
<span class="normal"><a href="#__codelineno-0-85">  85</a></span>
<span class="normal"><a href="#__codelineno-0-86">  86</a></span>
<span class="normal"><a href="#__codelineno-0-87">  87</a></span>
<span class="normal"><a href="#__codelineno-0-88">  88</a></span>
<span class="normal"><a href="#__codelineno-0-89">  89</a></span>
<span class="normal"><a href="#__codelineno-0-90">  90</a></span>
<span class="normal"><a href="#__codelineno-0-91">  91</a></span>
<span class="normal"><a href="#__codelineno-0-92">  92</a></span>
<span class="normal"><a href="#__codelineno-0-93">  93</a></span>
<span class="normal"><a href="#__codelineno-0-94">  94</a></span>
<span class="normal"><a href="#__codelineno-0-95">  95</a></span>
<span class="normal"><a href="#__codelineno-0-96">  96</a></span>
<span class="normal"><a href="#__codelineno-0-97">  97</a></span>
<span class="normal"><a href="#__codelineno-0-98">  98</a></span>
<span class="normal"><a href="#__codelineno-0-99">  99</a></span>
<span class="normal"><a href="#__codelineno-0-100"> 100</a></span>
<span class="normal"><a href="#__codelineno-0-101"> 101</a></span>
<span class="normal"><a href="#__codelineno-0-102"> 102</a></span>
<span class="normal"><a href="#__codelineno-0-103"> 103</a></span>
<span class="normal"><a href="#__codelineno-0-104"> 104</a></span>
<span class="normal"><a href="#__codelineno-0-105"> 105</a></span>
<span class="normal"><a href="#__codelineno-0-106"> 106</a></span>
<span class="normal"><a href="#__codelineno-0-107"> 107</a></span>
<span class="normal"><a href="#__codelineno-0-108"> 108</a></span>
<span class="normal"><a href="#__codelineno-0-109"> 109</a></span>
<span class="normal"><a href="#__codelineno-0-110"> 110</a></span>
<span class="normal"><a href="#__codelineno-0-111"> 111</a></span>
<span class="normal"><a href="#__codelineno-0-112"> 112</a></span>
<span class="normal"><a href="#__codelineno-0-113"> 113</a></span>
<span class="normal"><a href="#__codelineno-0-114"> 114</a></span>
<span class="normal"><a href="#__codelineno-0-115"> 115</a></span>
<span class="normal"><a href="#__codelineno-0-116"> 116</a></span>
<span class="normal"><a href="#__codelineno-0-117"> 117</a></span>
<span class="normal"><a href="#__codelineno-0-118"> 118</a></span>
<span class="normal"><a href="#__codelineno-0-119"> 119</a></span>
<span class="normal"><a href="#__codelineno-0-120"> 120</a></span>
<span class="normal"><a href="#__codelineno-0-121"> 121</a></span>
<span class="normal"><a href="#__codelineno-0-122"> 122</a></span>
<span class="normal"><a href="#__codelineno-0-123"> 123</a></span>
<span class="normal"><a href="#__codelineno-0-124"> 124</a></span>
<span class="normal"><a href="#__codelineno-0-125"> 125</a></span>
<span class="normal"><a href="#__codelineno-0-126"> 126</a></span>
<span class="normal"><a href="#__codelineno-0-127"> 127</a></span>
<span class="normal"><a href="#__codelineno-0-128"> 128</a></span>
<span class="normal"><a href="#__codelineno-0-129"> 129</a></span>
<span class="normal"><a href="#__codelineno-0-130"> 130</a></span>
<span class="normal"><a href="#__codelineno-0-131"> 131</a></span>
<span class="normal"><a href="#__codelineno-0-132"> 132</a></span>
<span class="normal"><a href="#__codelineno-0-133"> 133</a></span>
<span class="normal"><a href="#__codelineno-0-134"> 134</a></span>
<span class="normal"><a href="#__codelineno-0-135"> 135</a></span>
<span class="normal"><a href="#__codelineno-0-136"> 136</a></span>
<span class="normal"><a href="#__codelineno-0-137"> 137</a></span>
<span class="normal"><a href="#__codelineno-0-138"> 138</a></span>
<span class="normal"><a href="#__codelineno-0-139"> 139</a></span>
<span class="normal"><a href="#__codelineno-0-140"> 140</a></span>
<span class="normal"><a href="#__codelineno-0-141"> 141</a></span>
<span class="normal"><a href="#__codelineno-0-142"> 142</a></span>
<span class="normal"><a href="#__codelineno-0-143"> 143</a></span>
<span class="normal"><a href="#__codelineno-0-144"> 144</a></span>
<span class="normal"><a href="#__codelineno-0-145"> 145</a></span>
<span class="normal"><a href="#__codelineno-0-146"> 146</a></span>
<span class="normal"><a href="#__codelineno-0-147"> 147</a></span>
<span class="normal"><a href="#__codelineno-0-148"> 148</a></span>
<span class="normal"><a href="#__codelineno-0-149"> 149</a></span>
<span class="normal"><a href="#__codelineno-0-150"> 150</a></span>
<span class="normal"><a href="#__codelineno-0-151"> 151</a></span>
<span class="normal"><a href="#__codelineno-0-152"> 152</a></span>
<span class="normal"><a href="#__codelineno-0-153"> 153</a></span>
<span class="normal"><a href="#__codelineno-0-154"> 154</a></span>
<span class="normal"><a href="#__codelineno-0-155"> 155</a></span>
<span class="normal"><a href="#__codelineno-0-156"> 156</a></span>
<span class="normal"><a href="#__codelineno-0-157"> 157</a></span>
<span class="normal"><a href="#__codelineno-0-158"> 158</a></span>
<span class="normal"><a href="#__codelineno-0-159"> 159</a></span>
<span class="normal"><a href="#__codelineno-0-160"> 160</a></span>
<span class="normal"><a href="#__codelineno-0-161"> 161</a></span>
<span class="normal"><a href="#__codelineno-0-162"> 162</a></span>
<span class="normal"><a href="#__codelineno-0-163"> 163</a></span>
<span class="normal"><a href="#__codelineno-0-164"> 164</a></span>
<span class="normal"><a href="#__codelineno-0-165"> 165</a></span>
<span class="normal"><a href="#__codelineno-0-166"> 166</a></span>
<span class="normal"><a href="#__codelineno-0-167"> 167</a></span>
<span class="normal"><a href="#__codelineno-0-168"> 168</a></span>
<span class="normal"><a href="#__codelineno-0-169"> 169</a></span>
<span class="normal"><a href="#__codelineno-0-170"> 170</a></span>
<span class="normal"><a href="#__codelineno-0-171"> 171</a></span>
<span class="normal"><a href="#__codelineno-0-172"> 172</a></span>
<span class="normal"><a href="#__codelineno-0-173"> 173</a></span>
<span class="normal"><a href="#__codelineno-0-174"> 174</a></span>
<span class="normal"><a href="#__codelineno-0-175"> 175</a></span>
<span class="normal"><a href="#__codelineno-0-176"> 176</a></span>
<span class="normal"><a href="#__codelineno-0-177"> 177</a></span>
<span class="normal"><a href="#__codelineno-0-178"> 178</a></span>
<span class="normal"><a href="#__codelineno-0-179"> 179</a></span>
<span class="normal"><a href="#__codelineno-0-180"> 180</a></span>
<span class="normal"><a href="#__codelineno-0-181"> 181</a></span>
<span class="normal"><a href="#__codelineno-0-182"> 182</a></span>
<span class="normal"><a href="#__codelineno-0-183"> 183</a></span>
<span class="normal"><a href="#__codelineno-0-184"> 184</a></span>
<span class="normal"><a href="#__codelineno-0-185"> 185</a></span>
<span class="normal"><a href="#__codelineno-0-186"> 186</a></span>
<span class="normal"><a href="#__codelineno-0-187"> 187</a></span>
<span class="normal"><a href="#__codelineno-0-188"> 188</a></span>
<span class="normal"><a href="#__codelineno-0-189"> 189</a></span>
<span class="normal"><a href="#__codelineno-0-190"> 190</a></span>
<span class="normal"><a href="#__codelineno-0-191"> 191</a></span>
<span class="normal"><a href="#__codelineno-0-192"> 192</a></span>
<span class="normal"><a href="#__codelineno-0-193"> 193</a></span>
<span class="normal"><a href="#__codelineno-0-194"> 194</a></span>
<span class="normal"><a href="#__codelineno-0-195"> 195</a></span>
<span class="normal"><a href="#__codelineno-0-196"> 196</a></span>
<span class="normal"><a href="#__codelineno-0-197"> 197</a></span>
<span class="normal"><a href="#__codelineno-0-198"> 198</a></span>
<span class="normal"><a href="#__codelineno-0-199"> 199</a></span>
<span class="normal"><a href="#__codelineno-0-200"> 200</a></span>
<span class="normal"><a href="#__codelineno-0-201"> 201</a></span>
<span class="normal"><a href="#__codelineno-0-202"> 202</a></span>
<span class="normal"><a href="#__codelineno-0-203"> 203</a></span>
<span class="normal"><a href="#__codelineno-0-204"> 204</a></span>
<span class="normal"><a href="#__codelineno-0-205"> 205</a></span>
<span class="normal"><a href="#__codelineno-0-206"> 206</a></span>
<span class="normal"><a href="#__codelineno-0-207"> 207</a></span>
<span class="normal"><a href="#__codelineno-0-208"> 208</a></span>
<span class="normal"><a href="#__codelineno-0-209"> 209</a></span>
<span class="normal"><a href="#__codelineno-0-210"> 210</a></span>
<span class="normal"><a href="#__codelineno-0-211"> 211</a></span>
<span class="normal"><a href="#__codelineno-0-212"> 212</a></span>
<span class="normal"><a href="#__codelineno-0-213"> 213</a></span>
<span class="normal"><a href="#__codelineno-0-214"> 214</a></span>
<span class="normal"><a href="#__codelineno-0-215"> 215</a></span>
<span class="normal"><a href="#__codelineno-0-216"> 216</a></span>
<span class="normal"><a href="#__codelineno-0-217"> 217</a></span>
<span class="normal"><a href="#__codelineno-0-218"> 218</a></span>
<span class="normal"><a href="#__codelineno-0-219"> 219</a></span>
<span class="normal"><a href="#__codelineno-0-220"> 220</a></span>
<span class="normal"><a href="#__codelineno-0-221"> 221</a></span>
<span class="normal"><a href="#__codelineno-0-222"> 222</a></span>
<span class="normal"><a href="#__codelineno-0-223"> 223</a></span>
<span class="normal"><a href="#__codelineno-0-224"> 224</a></span>
<span class="normal"><a href="#__codelineno-0-225"> 225</a></span>
<span class="normal"><a href="#__codelineno-0-226"> 226</a></span>
<span class="normal"><a href="#__codelineno-0-227"> 227</a></span>
<span class="normal"><a href="#__codelineno-0-228"> 228</a></span>
<span class="normal"><a href="#__codelineno-0-229"> 229</a></span>
<span class="normal"><a href="#__codelineno-0-230"> 230</a></span>
<span class="normal"><a href="#__codelineno-0-231"> 231</a></span>
<span class="normal"><a href="#__codelineno-0-232"> 232</a></span>
<span class="normal"><a href="#__codelineno-0-233"> 233</a></span>
<span class="normal"><a href="#__codelineno-0-234"> 234</a></span>
<span class="normal"><a href="#__codelineno-0-235"> 235</a></span>
<span class="normal"><a href="#__codelineno-0-236"> 236</a></span>
<span class="normal"><a href="#__codelineno-0-237"> 237</a></span>
<span class="normal"><a href="#__codelineno-0-238"> 238</a></span>
<span class="normal"><a href="#__codelineno-0-239"> 239</a></span>
<span class="normal"><a href="#__codelineno-0-240"> 240</a></span>
<span class="normal"><a href="#__codelineno-0-241"> 241</a></span>
<span class="normal"><a href="#__codelineno-0-242"> 242</a></span>
<span class="normal"><a href="#__codelineno-0-243"> 243</a></span>
<span class="normal"><a href="#__codelineno-0-244"> 244</a></span>
<span class="normal"><a href="#__codelineno-0-245"> 245</a></span>
<span class="normal"><a href="#__codelineno-0-246"> 246</a></span>
<span class="normal"><a href="#__codelineno-0-247"> 247</a></span>
<span class="normal"><a href="#__codelineno-0-248"> 248</a></span>
<span class="normal"><a href="#__codelineno-0-249"> 249</a></span>
<span class="normal"><a href="#__codelineno-0-250"> 250</a></span>
<span class="normal"><a href="#__codelineno-0-251"> 251</a></span>
<span class="normal"><a href="#__codelineno-0-252"> 252</a></span>
<span class="normal"><a href="#__codelineno-0-253"> 253</a></span>
<span class="normal"><a href="#__codelineno-0-254"> 254</a></span>
<span class="normal"><a href="#__codelineno-0-255"> 255</a></span>
<span class="normal"><a href="#__codelineno-0-256"> 256</a></span>
<span class="normal"><a href="#__codelineno-0-257"> 257</a></span>
<span class="normal"><a href="#__codelineno-0-258"> 258</a></span>
<span class="normal"><a href="#__codelineno-0-259"> 259</a></span>
<span class="normal"><a href="#__codelineno-0-260"> 260</a></span>
<span class="normal"><a href="#__codelineno-0-261"> 261</a></span>
<span class="normal"><a href="#__codelineno-0-262"> 262</a></span>
<span class="normal"><a href="#__codelineno-0-263"> 263</a></span>
<span class="normal"><a href="#__codelineno-0-264"> 264</a></span>
<span class="normal"><a href="#__codelineno-0-265"> 265</a></span>
<span class="normal"><a href="#__codelineno-0-266"> 266</a></span>
<span class="normal"><a href="#__codelineno-0-267"> 267</a></span>
<span class="normal"><a href="#__codelineno-0-268"> 268</a></span>
<span class="normal"><a href="#__codelineno-0-269"> 269</a></span>
<span class="normal"><a href="#__codelineno-0-270"> 270</a></span>
<span class="normal"><a href="#__codelineno-0-271"> 271</a></span>
<span class="normal"><a href="#__codelineno-0-272"> 272</a></span>
<span class="normal"><a href="#__codelineno-0-273"> 273</a></span>
<span class="normal"><a href="#__codelineno-0-274"> 274</a></span>
<span class="normal"><a href="#__codelineno-0-275"> 275</a></span>
<span class="normal"><a href="#__codelineno-0-276"> 276</a></span>
<span class="normal"><a href="#__codelineno-0-277"> 277</a></span>
<span class="normal"><a href="#__codelineno-0-278"> 278</a></span>
<span class="normal"><a href="#__codelineno-0-279"> 279</a></span>
<span class="normal"><a href="#__codelineno-0-280"> 280</a></span>
<span class="normal"><a href="#__codelineno-0-281"> 281</a></span>
<span class="normal"><a href="#__codelineno-0-282"> 282</a></span>
<span class="normal"><a href="#__codelineno-0-283"> 283</a></span>
<span class="normal"><a href="#__codelineno-0-284"> 284</a></span>
<span class="normal"><a href="#__codelineno-0-285"> 285</a></span>
<span class="normal"><a href="#__codelineno-0-286"> 286</a></span>
<span class="normal"><a href="#__codelineno-0-287"> 287</a></span>
<span class="normal"><a href="#__codelineno-0-288"> 288</a></span>
<span class="normal"><a href="#__codelineno-0-289"> 289</a></span>
<span class="normal"><a href="#__codelineno-0-290"> 290</a></span>
<span class="normal"><a href="#__codelineno-0-291"> 291</a></span>
<span class="normal"><a href="#__codelineno-0-292"> 292</a></span>
<span class="normal"><a href="#__codelineno-0-293"> 293</a></span>
<span class="normal"><a href="#__codelineno-0-294"> 294</a></span>
<span class="normal"><a href="#__codelineno-0-295"> 295</a></span>
<span class="normal"><a href="#__codelineno-0-296"> 296</a></span>
<span class="normal"><a href="#__codelineno-0-297"> 297</a></span>
<span class="normal"><a href="#__codelineno-0-298"> 298</a></span>
<span class="normal"><a href="#__codelineno-0-299"> 299</a></span>
<span class="normal"><a href="#__codelineno-0-300"> 300</a></span>
<span class="normal"><a href="#__codelineno-0-301"> 301</a></span>
<span class="normal"><a href="#__codelineno-0-302"> 302</a></span>
<span class="normal"><a href="#__codelineno-0-303"> 303</a></span>
<span class="normal"><a href="#__codelineno-0-304"> 304</a></span>
<span class="normal"><a href="#__codelineno-0-305"> 305</a></span>
<span class="normal"><a href="#__codelineno-0-306"> 306</a></span>
<span class="normal"><a href="#__codelineno-0-307"> 307</a></span>
<span class="normal"><a href="#__codelineno-0-308"> 308</a></span>
<span class="normal"><a href="#__codelineno-0-309"> 309</a></span>
<span class="normal"><a href="#__codelineno-0-310"> 310</a></span>
<span class="normal"><a href="#__codelineno-0-311"> 311</a></span>
<span class="normal"><a href="#__codelineno-0-312"> 312</a></span>
<span class="normal"><a href="#__codelineno-0-313"> 313</a></span>
<span class="normal"><a href="#__codelineno-0-314"> 314</a></span>
<span class="normal"><a href="#__codelineno-0-315"> 315</a></span>
<span class="normal"><a href="#__codelineno-0-316"> 316</a></span>
<span class="normal"><a href="#__codelineno-0-317"> 317</a></span>
<span class="normal"><a href="#__codelineno-0-318"> 318</a></span>
<span class="normal"><a href="#__codelineno-0-319"> 319</a></span>
<span class="normal"><a href="#__codelineno-0-320"> 320</a></span>
<span class="normal"><a href="#__codelineno-0-321"> 321</a></span>
<span class="normal"><a href="#__codelineno-0-322"> 322</a></span>
<span class="normal"><a href="#__codelineno-0-323"> 323</a></span>
<span class="normal"><a href="#__codelineno-0-324"> 324</a></span>
<span class="normal"><a href="#__codelineno-0-325"> 325</a></span>
<span class="normal"><a href="#__codelineno-0-326"> 326</a></span>
<span class="normal"><a href="#__codelineno-0-327"> 327</a></span>
<span class="normal"><a href="#__codelineno-0-328"> 328</a></span>
<span class="normal"><a href="#__codelineno-0-329"> 329</a></span>
<span class="normal"><a href="#__codelineno-0-330"> 330</a></span>
<span class="normal"><a href="#__codelineno-0-331"> 331</a></span>
<span class="normal"><a href="#__codelineno-0-332"> 332</a></span>
<span class="normal"><a href="#__codelineno-0-333"> 333</a></span>
<span class="normal"><a href="#__codelineno-0-334"> 334</a></span>
<span class="normal"><a href="#__codelineno-0-335"> 335</a></span>
<span class="normal"><a href="#__codelineno-0-336"> 336</a></span>
<span class="normal"><a href="#__codelineno-0-337"> 337</a></span>
<span class="normal"><a href="#__codelineno-0-338"> 338</a></span>
<span class="normal"><a href="#__codelineno-0-339"> 339</a></span>
<span class="normal"><a href="#__codelineno-0-340"> 340</a></span>
<span class="normal"><a href="#__codelineno-0-341"> 341</a></span>
<span class="normal"><a href="#__codelineno-0-342"> 342</a></span>
<span class="normal"><a href="#__codelineno-0-343"> 343</a></span>
<span class="normal"><a href="#__codelineno-0-344"> 344</a></span>
<span class="normal"><a href="#__codelineno-0-345"> 345</a></span>
<span class="normal"><a href="#__codelineno-0-346"> 346</a></span>
<span class="normal"><a href="#__codelineno-0-347"> 347</a></span>
<span class="normal"><a href="#__codelineno-0-348"> 348</a></span>
<span class="normal"><a href="#__codelineno-0-349"> 349</a></span>
<span class="normal"><a href="#__codelineno-0-350"> 350</a></span>
<span class="normal"><a href="#__codelineno-0-351"> 351</a></span>
<span class="normal"><a href="#__codelineno-0-352"> 352</a></span>
<span class="normal"><a href="#__codelineno-0-353"> 353</a></span>
<span class="normal"><a href="#__codelineno-0-354"> 354</a></span>
<span class="normal"><a href="#__codelineno-0-355"> 355</a></span>
<span class="normal"><a href="#__codelineno-0-356"> 356</a></span>
<span class="normal"><a href="#__codelineno-0-357"> 357</a></span>
<span class="normal"><a href="#__codelineno-0-358"> 358</a></span>
<span class="normal"><a href="#__codelineno-0-359"> 359</a></span>
<span class="normal"><a href="#__codelineno-0-360"> 360</a></span>
<span class="normal"><a href="#__codelineno-0-361"> 361</a></span>
<span class="normal"><a href="#__codelineno-0-362"> 362</a></span>
<span class="normal"><a href="#__codelineno-0-363"> 363</a></span>
<span class="normal"><a href="#__codelineno-0-364"> 364</a></span>
<span class="normal"><a href="#__codelineno-0-365"> 365</a></span>
<span class="normal"><a href="#__codelineno-0-366"> 366</a></span>
<span class="normal"><a href="#__codelineno-0-367"> 367</a></span>
<span class="normal"><a href="#__codelineno-0-368"> 368</a></span>
<span class="normal"><a href="#__codelineno-0-369"> 369</a></span>
<span class="normal"><a href="#__codelineno-0-370"> 370</a></span>
<span class="normal"><a href="#__codelineno-0-371"> 371</a></span>
<span class="normal"><a href="#__codelineno-0-372"> 372</a></span>
<span class="normal"><a href="#__codelineno-0-373"> 373</a></span>
<span class="normal"><a href="#__codelineno-0-374"> 374</a></span>
<span class="normal"><a href="#__codelineno-0-375"> 375</a></span>
<span class="normal"><a href="#__codelineno-0-376"> 376</a></span>
<span class="normal"><a href="#__codelineno-0-377"> 377</a></span>
<span class="normal"><a href="#__codelineno-0-378"> 378</a></span>
<span class="normal"><a href="#__codelineno-0-379"> 379</a></span>
<span class="normal"><a href="#__codelineno-0-380"> 380</a></span>
<span class="normal"><a href="#__codelineno-0-381"> 381</a></span>
<span class="normal"><a href="#__codelineno-0-382"> 382</a></span>
<span class="normal"><a href="#__codelineno-0-383"> 383</a></span>
<span class="normal"><a href="#__codelineno-0-384"> 384</a></span>
<span class="normal"><a href="#__codelineno-0-385"> 385</a></span>
<span class="normal"><a href="#__codelineno-0-386"> 386</a></span>
<span class="normal"><a href="#__codelineno-0-387"> 387</a></span>
<span class="normal"><a href="#__codelineno-0-388"> 388</a></span>
<span class="normal"><a href="#__codelineno-0-389"> 389</a></span>
<span class="normal"><a href="#__codelineno-0-390"> 390</a></span>
<span class="normal"><a href="#__codelineno-0-391"> 391</a></span>
<span class="normal"><a href="#__codelineno-0-392"> 392</a></span>
<span class="normal"><a href="#__codelineno-0-393"> 393</a></span>
<span class="normal"><a href="#__codelineno-0-394"> 394</a></span>
<span class="normal"><a href="#__codelineno-0-395"> 395</a></span>
<span class="normal"><a href="#__codelineno-0-396"> 396</a></span>
<span class="normal"><a href="#__codelineno-0-397"> 397</a></span>
<span class="normal"><a href="#__codelineno-0-398"> 398</a></span>
<span class="normal"><a href="#__codelineno-0-399"> 399</a></span>
<span class="normal"><a href="#__codelineno-0-400"> 400</a></span>
<span class="normal"><a href="#__codelineno-0-401"> 401</a></span>
<span class="normal"><a href="#__codelineno-0-402"> 402</a></span>
<span class="normal"><a href="#__codelineno-0-403"> 403</a></span>
<span class="normal"><a href="#__codelineno-0-404"> 404</a></span>
<span class="normal"><a href="#__codelineno-0-405"> 405</a></span>
<span class="normal"><a href="#__codelineno-0-406"> 406</a></span>
<span class="normal"><a href="#__codelineno-0-407"> 407</a></span>
<span class="normal"><a href="#__codelineno-0-408"> 408</a></span>
<span class="normal"><a href="#__codelineno-0-409"> 409</a></span>
<span class="normal"><a href="#__codelineno-0-410"> 410</a></span>
<span class="normal"><a href="#__codelineno-0-411"> 411</a></span>
<span class="normal"><a href="#__codelineno-0-412"> 412</a></span>
<span class="normal"><a href="#__codelineno-0-413"> 413</a></span>
<span class="normal"><a href="#__codelineno-0-414"> 414</a></span>
<span class="normal"><a href="#__codelineno-0-415"> 415</a></span>
<span class="normal"><a href="#__codelineno-0-416"> 416</a></span>
<span class="normal"><a href="#__codelineno-0-417"> 417</a></span>
<span class="normal"><a href="#__codelineno-0-418"> 418</a></span>
<span class="normal"><a href="#__codelineno-0-419"> 419</a></span>
<span class="normal"><a href="#__codelineno-0-420"> 420</a></span>
<span class="normal"><a href="#__codelineno-0-421"> 421</a></span>
<span class="normal"><a href="#__codelineno-0-422"> 422</a></span>
<span class="normal"><a href="#__codelineno-0-423"> 423</a></span>
<span class="normal"><a href="#__codelineno-0-424"> 424</a></span>
<span class="normal"><a href="#__codelineno-0-425"> 425</a></span>
<span class="normal"><a href="#__codelineno-0-426"> 426</a></span>
<span class="normal"><a href="#__codelineno-0-427"> 427</a></span>
<span class="normal"><a href="#__codelineno-0-428"> 428</a></span>
<span class="normal"><a href="#__codelineno-0-429"> 429</a></span>
<span class="normal"><a href="#__codelineno-0-430"> 430</a></span>
<span class="normal"><a href="#__codelineno-0-431"> 431</a></span>
<span class="normal"><a href="#__codelineno-0-432"> 432</a></span>
<span class="normal"><a href="#__codelineno-0-433"> 433</a></span>
<span class="normal"><a href="#__codelineno-0-434"> 434</a></span>
<span class="normal"><a href="#__codelineno-0-435"> 435</a></span>
<span class="normal"><a href="#__codelineno-0-436"> 436</a></span>
<span class="normal"><a href="#__codelineno-0-437"> 437</a></span>
<span class="normal"><a href="#__codelineno-0-438"> 438</a></span>
<span class="normal"><a href="#__codelineno-0-439"> 439</a></span>
<span class="normal"><a href="#__codelineno-0-440"> 440</a></span>
<span class="normal"><a href="#__codelineno-0-441"> 441</a></span>
<span class="normal"><a href="#__codelineno-0-442"> 442</a></span>
<span class="normal"><a href="#__codelineno-0-443"> 443</a></span>
<span class="normal"><a href="#__codelineno-0-444"> 444</a></span>
<span class="normal"><a href="#__codelineno-0-445"> 445</a></span>
<span class="normal"><a href="#__codelineno-0-446"> 446</a></span>
<span class="normal"><a href="#__codelineno-0-447"> 447</a></span>
<span class="normal"><a href="#__codelineno-0-448"> 448</a></span>
<span class="normal"><a href="#__codelineno-0-449"> 449</a></span>
<span class="normal"><a href="#__codelineno-0-450"> 450</a></span>
<span class="normal"><a href="#__codelineno-0-451"> 451</a></span>
<span class="normal"><a href="#__codelineno-0-452"> 452</a></span>
<span class="normal"><a href="#__codelineno-0-453"> 453</a></span>
<span class="normal"><a href="#__codelineno-0-454"> 454</a></span>
<span class="normal"><a href="#__codelineno-0-455"> 455</a></span>
<span class="normal"><a href="#__codelineno-0-456"> 456</a></span>
<span class="normal"><a href="#__codelineno-0-457"> 457</a></span>
<span class="normal"><a href="#__codelineno-0-458"> 458</a></span>
<span class="normal"><a href="#__codelineno-0-459"> 459</a></span>
<span class="normal"><a href="#__codelineno-0-460"> 460</a></span>
<span class="normal"><a href="#__codelineno-0-461"> 461</a></span>
<span class="normal"><a href="#__codelineno-0-462"> 462</a></span>
<span class="normal"><a href="#__codelineno-0-463"> 463</a></span>
<span class="normal"><a href="#__codelineno-0-464"> 464</a></span>
<span class="normal"><a href="#__codelineno-0-465"> 465</a></span>
<span class="normal"><a href="#__codelineno-0-466"> 466</a></span>
<span class="normal"><a href="#__codelineno-0-467"> 467</a></span>
<span class="normal"><a href="#__codelineno-0-468"> 468</a></span>
<span class="normal"><a href="#__codelineno-0-469"> 469</a></span>
<span class="normal"><a href="#__codelineno-0-470"> 470</a></span>
<span class="normal"><a href="#__codelineno-0-471"> 471</a></span>
<span class="normal"><a href="#__codelineno-0-472"> 472</a></span>
<span class="normal"><a href="#__codelineno-0-473"> 473</a></span>
<span class="normal"><a href="#__codelineno-0-474"> 474</a></span>
<span class="normal"><a href="#__codelineno-0-475"> 475</a></span>
<span class="normal"><a href="#__codelineno-0-476"> 476</a></span>
<span class="normal"><a href="#__codelineno-0-477"> 477</a></span>
<span class="normal"><a href="#__codelineno-0-478"> 478</a></span>
<span class="normal"><a href="#__codelineno-0-479"> 479</a></span>
<span class="normal"><a href="#__codelineno-0-480"> 480</a></span>
<span class="normal"><a href="#__codelineno-0-481"> 481</a></span>
<span class="normal"><a href="#__codelineno-0-482"> 482</a></span>
<span class="normal"><a href="#__codelineno-0-483"> 483</a></span>
<span class="normal"><a href="#__codelineno-0-484"> 484</a></span>
<span class="normal"><a href="#__codelineno-0-485"> 485</a></span>
<span class="normal"><a href="#__codelineno-0-486"> 486</a></span>
<span class="normal"><a href="#__codelineno-0-487"> 487</a></span>
<span class="normal"><a href="#__codelineno-0-488"> 488</a></span>
<span class="normal"><a href="#__codelineno-0-489"> 489</a></span>
<span class="normal"><a href="#__codelineno-0-490"> 490</a></span>
<span class="normal"><a href="#__codelineno-0-491"> 491</a></span>
<span class="normal"><a href="#__codelineno-0-492"> 492</a></span>
<span class="normal"><a href="#__codelineno-0-493"> 493</a></span>
<span class="normal"><a href="#__codelineno-0-494"> 494</a></span>
<span class="normal"><a href="#__codelineno-0-495"> 495</a></span>
<span class="normal"><a href="#__codelineno-0-496"> 496</a></span>
<span class="normal"><a href="#__codelineno-0-497"> 497</a></span>
<span class="normal"><a href="#__codelineno-0-498"> 498</a></span>
<span class="normal"><a href="#__codelineno-0-499"> 499</a></span>
<span class="normal"><a href="#__codelineno-0-500"> 500</a></span>
<span class="normal"><a href="#__codelineno-0-501"> 501</a></span>
<span class="normal"><a href="#__codelineno-0-502"> 502</a></span>
<span class="normal"><a href="#__codelineno-0-503"> 503</a></span>
<span class="normal"><a href="#__codelineno-0-504"> 504</a></span>
<span class="normal"><a href="#__codelineno-0-505"> 505</a></span>
<span class="normal"><a href="#__codelineno-0-506"> 506</a></span>
<span class="normal"><a href="#__codelineno-0-507"> 507</a></span>
<span class="normal"><a href="#__codelineno-0-508"> 508</a></span>
<span class="normal"><a href="#__codelineno-0-509"> 509</a></span>
<span class="normal"><a href="#__codelineno-0-510"> 510</a></span>
<span class="normal"><a href="#__codelineno-0-511"> 511</a></span>
<span class="normal"><a href="#__codelineno-0-512"> 512</a></span>
<span class="normal"><a href="#__codelineno-0-513"> 513</a></span>
<span class="normal"><a href="#__codelineno-0-514"> 514</a></span>
<span class="normal"><a href="#__codelineno-0-515"> 515</a></span>
<span class="normal"><a href="#__codelineno-0-516"> 516</a></span>
<span class="normal"><a href="#__codelineno-0-517"> 517</a></span>
<span class="normal"><a href="#__codelineno-0-518"> 518</a></span>
<span class="normal"><a href="#__codelineno-0-519"> 519</a></span>
<span class="normal"><a href="#__codelineno-0-520"> 520</a></span>
<span class="normal"><a href="#__codelineno-0-521"> 521</a></span>
<span class="normal"><a href="#__codelineno-0-522"> 522</a></span>
<span class="normal"><a href="#__codelineno-0-523"> 523</a></span>
<span class="normal"><a href="#__codelineno-0-524"> 524</a></span>
<span class="normal"><a href="#__codelineno-0-525"> 525</a></span>
<span class="normal"><a href="#__codelineno-0-526"> 526</a></span>
<span class="normal"><a href="#__codelineno-0-527"> 527</a></span>
<span class="normal"><a href="#__codelineno-0-528"> 528</a></span>
<span class="normal"><a href="#__codelineno-0-529"> 529</a></span>
<span class="normal"><a href="#__codelineno-0-530"> 530</a></span>
<span class="normal"><a href="#__codelineno-0-531"> 531</a></span>
<span class="normal"><a href="#__codelineno-0-532"> 532</a></span>
<span class="normal"><a href="#__codelineno-0-533"> 533</a></span>
<span class="normal"><a href="#__codelineno-0-534"> 534</a></span>
<span class="normal"><a href="#__codelineno-0-535"> 535</a></span>
<span class="normal"><a href="#__codelineno-0-536"> 536</a></span>
<span class="normal"><a href="#__codelineno-0-537"> 537</a></span>
<span class="normal"><a href="#__codelineno-0-538"> 538</a></span>
<span class="normal"><a href="#__codelineno-0-539"> 539</a></span>
<span class="normal"><a href="#__codelineno-0-540"> 540</a></span>
<span class="normal"><a href="#__codelineno-0-541"> 541</a></span>
<span class="normal"><a href="#__codelineno-0-542"> 542</a></span>
<span class="normal"><a href="#__codelineno-0-543"> 543</a></span>
<span class="normal"><a href="#__codelineno-0-544"> 544</a></span>
<span class="normal"><a href="#__codelineno-0-545"> 545</a></span>
<span class="normal"><a href="#__codelineno-0-546"> 546</a></span>
<span class="normal"><a href="#__codelineno-0-547"> 547</a></span>
<span class="normal"><a href="#__codelineno-0-548"> 548</a></span>
<span class="normal"><a href="#__codelineno-0-549"> 549</a></span>
<span class="normal"><a href="#__codelineno-0-550"> 550</a></span>
<span class="normal"><a href="#__codelineno-0-551"> 551</a></span>
<span class="normal"><a href="#__codelineno-0-552"> 552</a></span>
<span class="normal"><a href="#__codelineno-0-553"> 553</a></span>
<span class="normal"><a href="#__codelineno-0-554"> 554</a></span>
<span class="normal"><a href="#__codelineno-0-555"> 555</a></span>
<span class="normal"><a href="#__codelineno-0-556"> 556</a></span>
<span class="normal"><a href="#__codelineno-0-557"> 557</a></span>
<span class="normal"><a href="#__codelineno-0-558"> 558</a></span>
<span class="normal"><a href="#__codelineno-0-559"> 559</a></span>
<span class="normal"><a href="#__codelineno-0-560"> 560</a></span>
<span class="normal"><a href="#__codelineno-0-561"> 561</a></span>
<span class="normal"><a href="#__codelineno-0-562"> 562</a></span>
<span class="normal"><a href="#__codelineno-0-563"> 563</a></span>
<span class="normal"><a href="#__codelineno-0-564"> 564</a></span>
<span class="normal"><a href="#__codelineno-0-565"> 565</a></span>
<span class="normal"><a href="#__codelineno-0-566"> 566</a></span>
<span class="normal"><a href="#__codelineno-0-567"> 567</a></span>
<span class="normal"><a href="#__codelineno-0-568"> 568</a></span>
<span class="normal"><a href="#__codelineno-0-569"> 569</a></span>
<span class="normal"><a href="#__codelineno-0-570"> 570</a></span>
<span class="normal"><a href="#__codelineno-0-571"> 571</a></span>
<span class="normal"><a href="#__codelineno-0-572"> 572</a></span>
<span class="normal"><a href="#__codelineno-0-573"> 573</a></span>
<span class="normal"><a href="#__codelineno-0-574"> 574</a></span>
<span class="normal"><a href="#__codelineno-0-575"> 575</a></span>
<span class="normal"><a href="#__codelineno-0-576"> 576</a></span>
<span class="normal"><a href="#__codelineno-0-577"> 577</a></span>
<span class="normal"><a href="#__codelineno-0-578"> 578</a></span>
<span class="normal"><a href="#__codelineno-0-579"> 579</a></span>
<span class="normal"><a href="#__codelineno-0-580"> 580</a></span>
<span class="normal"><a href="#__codelineno-0-581"> 581</a></span>
<span class="normal"><a href="#__codelineno-0-582"> 582</a></span>
<span class="normal"><a href="#__codelineno-0-583"> 583</a></span>
<span class="normal"><a href="#__codelineno-0-584"> 584</a></span>
<span class="normal"><a href="#__codelineno-0-585"> 585</a></span>
<span class="normal"><a href="#__codelineno-0-586"> 586</a></span>
<span class="normal"><a href="#__codelineno-0-587"> 587</a></span>
<span class="normal"><a href="#__codelineno-0-588"> 588</a></span>
<span class="normal"><a href="#__codelineno-0-589"> 589</a></span>
<span class="normal"><a href="#__codelineno-0-590"> 590</a></span>
<span class="normal"><a href="#__codelineno-0-591"> 591</a></span>
<span class="normal"><a href="#__codelineno-0-592"> 592</a></span>
<span class="normal"><a href="#__codelineno-0-593"> 593</a></span>
<span class="normal"><a href="#__codelineno-0-594"> 594</a></span>
<span class="normal"><a href="#__codelineno-0-595"> 595</a></span>
<span class="normal"><a href="#__codelineno-0-596"> 596</a></span>
<span class="normal"><a href="#__codelineno-0-597"> 597</a></span>
<span class="normal"><a href="#__codelineno-0-598"> 598</a></span>
<span class="normal"><a href="#__codelineno-0-599"> 599</a></span>
<span class="normal"><a href="#__codelineno-0-600"> 600</a></span>
<span class="normal"><a href="#__codelineno-0-601"> 601</a></span>
<span class="normal"><a href="#__codelineno-0-602"> 602</a></span>
<span class="normal"><a href="#__codelineno-0-603"> 603</a></span>
<span class="normal"><a href="#__codelineno-0-604"> 604</a></span>
<span class="normal"><a href="#__codelineno-0-605"> 605</a></span>
<span class="normal"><a href="#__codelineno-0-606"> 606</a></span>
<span class="normal"><a href="#__codelineno-0-607"> 607</a></span>
<span class="normal"><a href="#__codelineno-0-608"> 608</a></span>
<span class="normal"><a href="#__codelineno-0-609"> 609</a></span>
<span class="normal"><a href="#__codelineno-0-610"> 610</a></span>
<span class="normal"><a href="#__codelineno-0-611"> 611</a></span>
<span class="normal"><a href="#__codelineno-0-612"> 612</a></span>
<span class="normal"><a href="#__codelineno-0-613"> 613</a></span>
<span class="normal"><a href="#__codelineno-0-614"> 614</a></span>
<span class="normal"><a href="#__codelineno-0-615"> 615</a></span>
<span class="normal"><a href="#__codelineno-0-616"> 616</a></span>
<span class="normal"><a href="#__codelineno-0-617"> 617</a></span>
<span class="normal"><a href="#__codelineno-0-618"> 618</a></span>
<span class="normal"><a href="#__codelineno-0-619"> 619</a></span>
<span class="normal"><a href="#__codelineno-0-620"> 620</a></span>
<span class="normal"><a href="#__codelineno-0-621"> 621</a></span>
<span class="normal"><a href="#__codelineno-0-622"> 622</a></span>
<span class="normal"><a href="#__codelineno-0-623"> 623</a></span>
<span class="normal"><a href="#__codelineno-0-624"> 624</a></span>
<span class="normal"><a href="#__codelineno-0-625"> 625</a></span>
<span class="normal"><a href="#__codelineno-0-626"> 626</a></span>
<span class="normal"><a href="#__codelineno-0-627"> 627</a></span>
<span class="normal"><a href="#__codelineno-0-628"> 628</a></span>
<span class="normal"><a href="#__codelineno-0-629"> 629</a></span>
<span class="normal"><a href="#__codelineno-0-630"> 630</a></span>
<span class="normal"><a href="#__codelineno-0-631"> 631</a></span>
<span class="normal"><a href="#__codelineno-0-632"> 632</a></span>
<span class="normal"><a href="#__codelineno-0-633"> 633</a></span>
<span class="normal"><a href="#__codelineno-0-634"> 634</a></span>
<span class="normal"><a href="#__codelineno-0-635"> 635</a></span>
<span class="normal"><a href="#__codelineno-0-636"> 636</a></span>
<span class="normal"><a href="#__codelineno-0-637"> 637</a></span>
<span class="normal"><a href="#__codelineno-0-638"> 638</a></span>
<span class="normal"><a href="#__codelineno-0-639"> 639</a></span>
<span class="normal"><a href="#__codelineno-0-640"> 640</a></span>
<span class="normal"><a href="#__codelineno-0-641"> 641</a></span>
<span class="normal"><a href="#__codelineno-0-642"> 642</a></span>
<span class="normal"><a href="#__codelineno-0-643"> 643</a></span>
<span class="normal"><a href="#__codelineno-0-644"> 644</a></span>
<span class="normal"><a href="#__codelineno-0-645"> 645</a></span>
<span class="normal"><a href="#__codelineno-0-646"> 646</a></span>
<span class="normal"><a href="#__codelineno-0-647"> 647</a></span>
<span class="normal"><a href="#__codelineno-0-648"> 648</a></span>
<span class="normal"><a href="#__codelineno-0-649"> 649</a></span>
<span class="normal"><a href="#__codelineno-0-650"> 650</a></span>
<span class="normal"><a href="#__codelineno-0-651"> 651</a></span>
<span class="normal"><a href="#__codelineno-0-652"> 652</a></span>
<span class="normal"><a href="#__codelineno-0-653"> 653</a></span>
<span class="normal"><a href="#__codelineno-0-654"> 654</a></span>
<span class="normal"><a href="#__codelineno-0-655"> 655</a></span>
<span class="normal"><a href="#__codelineno-0-656"> 656</a></span>
<span class="normal"><a href="#__codelineno-0-657"> 657</a></span>
<span class="normal"><a href="#__codelineno-0-658"> 658</a></span>
<span class="normal"><a href="#__codelineno-0-659"> 659</a></span>
<span class="normal"><a href="#__codelineno-0-660"> 660</a></span>
<span class="normal"><a href="#__codelineno-0-661"> 661</a></span>
<span class="normal"><a href="#__codelineno-0-662"> 662</a></span>
<span class="normal"><a href="#__codelineno-0-663"> 663</a></span>
<span class="normal"><a href="#__codelineno-0-664"> 664</a></span>
<span class="normal"><a href="#__codelineno-0-665"> 665</a></span>
<span class="normal"><a href="#__codelineno-0-666"> 666</a></span>
<span class="normal"><a href="#__codelineno-0-667"> 667</a></span>
<span class="normal"><a href="#__codelineno-0-668"> 668</a></span>
<span class="normal"><a href="#__codelineno-0-669"> 669</a></span>
<span class="normal"><a href="#__codelineno-0-670"> 670</a></span>
<span class="normal"><a href="#__codelineno-0-671"> 671</a></span>
<span class="normal"><a href="#__codelineno-0-672"> 672</a></span>
<span class="normal"><a href="#__codelineno-0-673"> 673</a></span>
<span class="normal"><a href="#__codelineno-0-674"> 674</a></span>
<span class="normal"><a href="#__codelineno-0-675"> 675</a></span>
<span class="normal"><a href="#__codelineno-0-676"> 676</a></span>
<span class="normal"><a href="#__codelineno-0-677"> 677</a></span>
<span class="normal"><a href="#__codelineno-0-678"> 678</a></span>
<span class="normal"><a href="#__codelineno-0-679"> 679</a></span>
<span class="normal"><a href="#__codelineno-0-680"> 680</a></span>
<span class="normal"><a href="#__codelineno-0-681"> 681</a></span>
<span class="normal"><a href="#__codelineno-0-682"> 682</a></span>
<span class="normal"><a href="#__codelineno-0-683"> 683</a></span>
<span class="normal"><a href="#__codelineno-0-684"> 684</a></span>
<span class="normal"><a href="#__codelineno-0-685"> 685</a></span>
<span class="normal"><a href="#__codelineno-0-686"> 686</a></span>
<span class="normal"><a href="#__codelineno-0-687"> 687</a></span>
<span class="normal"><a href="#__codelineno-0-688"> 688</a></span>
<span class="normal"><a href="#__codelineno-0-689"> 689</a></span>
<span class="normal"><a href="#__codelineno-0-690"> 690</a></span>
<span class="normal"><a href="#__codelineno-0-691"> 691</a></span>
<span class="normal"><a href="#__codelineno-0-692"> 692</a></span>
<span class="normal"><a href="#__codelineno-0-693"> 693</a></span>
<span class="normal"><a href="#__codelineno-0-694"> 694</a></span>
<span class="normal"><a href="#__codelineno-0-695"> 695</a></span>
<span class="normal"><a href="#__codelineno-0-696"> 696</a></span>
<span class="normal"><a href="#__codelineno-0-697"> 697</a></span>
<span class="normal"><a href="#__codelineno-0-698"> 698</a></span>
<span class="normal"><a href="#__codelineno-0-699"> 699</a></span>
<span class="normal"><a href="#__codelineno-0-700"> 700</a></span>
<span class="normal"><a href="#__codelineno-0-701"> 701</a></span>
<span class="normal"><a href="#__codelineno-0-702"> 702</a></span>
<span class="normal"><a href="#__codelineno-0-703"> 703</a></span>
<span class="normal"><a href="#__codelineno-0-704"> 704</a></span>
<span class="normal"><a href="#__codelineno-0-705"> 705</a></span>
<span class="normal"><a href="#__codelineno-0-706"> 706</a></span>
<span class="normal"><a href="#__codelineno-0-707"> 707</a></span>
<span class="normal"><a href="#__codelineno-0-708"> 708</a></span>
<span class="normal"><a href="#__codelineno-0-709"> 709</a></span>
<span class="normal"><a href="#__codelineno-0-710"> 710</a></span>
<span class="normal"><a href="#__codelineno-0-711"> 711</a></span>
<span class="normal"><a href="#__codelineno-0-712"> 712</a></span>
<span class="normal"><a href="#__codelineno-0-713"> 713</a></span>
<span class="normal"><a href="#__codelineno-0-714"> 714</a></span>
<span class="normal"><a href="#__codelineno-0-715"> 715</a></span>
<span class="normal"><a href="#__codelineno-0-716"> 716</a></span>
<span class="normal"><a href="#__codelineno-0-717"> 717</a></span>
<span class="normal"><a href="#__codelineno-0-718"> 718</a></span>
<span class="normal"><a href="#__codelineno-0-719"> 719</a></span>
<span class="normal"><a href="#__codelineno-0-720"> 720</a></span>
<span class="normal"><a href="#__codelineno-0-721"> 721</a></span>
<span class="normal"><a href="#__codelineno-0-722"> 722</a></span>
<span class="normal"><a href="#__codelineno-0-723"> 723</a></span>
<span class="normal"><a href="#__codelineno-0-724"> 724</a></span>
<span class="normal"><a href="#__codelineno-0-725"> 725</a></span>
<span class="normal"><a href="#__codelineno-0-726"> 726</a></span>
<span class="normal"><a href="#__codelineno-0-727"> 727</a></span>
<span class="normal"><a href="#__codelineno-0-728"> 728</a></span>
<span class="normal"><a href="#__codelineno-0-729"> 729</a></span>
<span class="normal"><a href="#__codelineno-0-730"> 730</a></span>
<span class="normal"><a href="#__codelineno-0-731"> 731</a></span>
<span class="normal"><a href="#__codelineno-0-732"> 732</a></span>
<span class="normal"><a href="#__codelineno-0-733"> 733</a></span>
<span class="normal"><a href="#__codelineno-0-734"> 734</a></span>
<span class="normal"><a href="#__codelineno-0-735"> 735</a></span>
<span class="normal"><a href="#__codelineno-0-736"> 736</a></span>
<span class="normal"><a href="#__codelineno-0-737"> 737</a></span>
<span class="normal"><a href="#__codelineno-0-738"> 738</a></span>
<span class="normal"><a href="#__codelineno-0-739"> 739</a></span>
<span class="normal"><a href="#__codelineno-0-740"> 740</a></span>
<span class="normal"><a href="#__codelineno-0-741"> 741</a></span>
<span class="normal"><a href="#__codelineno-0-742"> 742</a></span>
<span class="normal"><a href="#__codelineno-0-743"> 743</a></span>
<span class="normal"><a href="#__codelineno-0-744"> 744</a></span>
<span class="normal"><a href="#__codelineno-0-745"> 745</a></span>
<span class="normal"><a href="#__codelineno-0-746"> 746</a></span>
<span class="normal"><a href="#__codelineno-0-747"> 747</a></span>
<span class="normal"><a href="#__codelineno-0-748"> 748</a></span>
<span class="normal"><a href="#__codelineno-0-749"> 749</a></span>
<span class="normal"><a href="#__codelineno-0-750"> 750</a></span>
<span class="normal"><a href="#__codelineno-0-751"> 751</a></span>
<span class="normal"><a href="#__codelineno-0-752"> 752</a></span>
<span class="normal"><a href="#__codelineno-0-753"> 753</a></span>
<span class="normal"><a href="#__codelineno-0-754"> 754</a></span>
<span class="normal"><a href="#__codelineno-0-755"> 755</a></span>
<span class="normal"><a href="#__codelineno-0-756"> 756</a></span>
<span class="normal"><a href="#__codelineno-0-757"> 757</a></span>
<span class="normal"><a href="#__codelineno-0-758"> 758</a></span>
<span class="normal"><a href="#__codelineno-0-759"> 759</a></span>
<span class="normal"><a href="#__codelineno-0-760"> 760</a></span>
<span class="normal"><a href="#__codelineno-0-761"> 761</a></span>
<span class="normal"><a href="#__codelineno-0-762"> 762</a></span>
<span class="normal"><a href="#__codelineno-0-763"> 763</a></span>
<span class="normal"><a href="#__codelineno-0-764"> 764</a></span>
<span class="normal"><a href="#__codelineno-0-765"> 765</a></span>
<span class="normal"><a href="#__codelineno-0-766"> 766</a></span>
<span class="normal"><a href="#__codelineno-0-767"> 767</a></span>
<span class="normal"><a href="#__codelineno-0-768"> 768</a></span>
<span class="normal"><a href="#__codelineno-0-769"> 769</a></span>
<span class="normal"><a href="#__codelineno-0-770"> 770</a></span>
<span class="normal"><a href="#__codelineno-0-771"> 771</a></span>
<span class="normal"><a href="#__codelineno-0-772"> 772</a></span>
<span class="normal"><a href="#__codelineno-0-773"> 773</a></span>
<span class="normal"><a href="#__codelineno-0-774"> 774</a></span>
<span class="normal"><a href="#__codelineno-0-775"> 775</a></span>
<span class="normal"><a href="#__codelineno-0-776"> 776</a></span>
<span class="normal"><a href="#__codelineno-0-777"> 777</a></span>
<span class="normal"><a href="#__codelineno-0-778"> 778</a></span>
<span class="normal"><a href="#__codelineno-0-779"> 779</a></span>
<span class="normal"><a href="#__codelineno-0-780"> 780</a></span>
<span class="normal"><a href="#__codelineno-0-781"> 781</a></span>
<span class="normal"><a href="#__codelineno-0-782"> 782</a></span>
<span class="normal"><a href="#__codelineno-0-783"> 783</a></span>
<span class="normal"><a href="#__codelineno-0-784"> 784</a></span>
<span class="normal"><a href="#__codelineno-0-785"> 785</a></span>
<span class="normal"><a href="#__codelineno-0-786"> 786</a></span>
<span class="normal"><a href="#__codelineno-0-787"> 787</a></span>
<span class="normal"><a href="#__codelineno-0-788"> 788</a></span>
<span class="normal"><a href="#__codelineno-0-789"> 789</a></span>
<span class="normal"><a href="#__codelineno-0-790"> 790</a></span>
<span class="normal"><a href="#__codelineno-0-791"> 791</a></span>
<span class="normal"><a href="#__codelineno-0-792"> 792</a></span>
<span class="normal"><a href="#__codelineno-0-793"> 793</a></span>
<span class="normal"><a href="#__codelineno-0-794"> 794</a></span>
<span class="normal"><a href="#__codelineno-0-795"> 795</a></span>
<span class="normal"><a href="#__codelineno-0-796"> 796</a></span>
<span class="normal"><a href="#__codelineno-0-797"> 797</a></span>
<span class="normal"><a href="#__codelineno-0-798"> 798</a></span>
<span class="normal"><a href="#__codelineno-0-799"> 799</a></span>
<span class="normal"><a href="#__codelineno-0-800"> 800</a></span>
<span class="normal"><a href="#__codelineno-0-801"> 801</a></span>
<span class="normal"><a href="#__codelineno-0-802"> 802</a></span>
<span class="normal"><a href="#__codelineno-0-803"> 803</a></span>
<span class="normal"><a href="#__codelineno-0-804"> 804</a></span>
<span class="normal"><a href="#__codelineno-0-805"> 805</a></span>
<span class="normal"><a href="#__codelineno-0-806"> 806</a></span>
<span class="normal"><a href="#__codelineno-0-807"> 807</a></span>
<span class="normal"><a href="#__codelineno-0-808"> 808</a></span>
<span class="normal"><a href="#__codelineno-0-809"> 809</a></span>
<span class="normal"><a href="#__codelineno-0-810"> 810</a></span>
<span class="normal"><a href="#__codelineno-0-811"> 811</a></span>
<span class="normal"><a href="#__codelineno-0-812"> 812</a></span>
<span class="normal"><a href="#__codelineno-0-813"> 813</a></span>
<span class="normal"><a href="#__codelineno-0-814"> 814</a></span>
<span class="normal"><a href="#__codelineno-0-815"> 815</a></span>
<span class="normal"><a href="#__codelineno-0-816"> 816</a></span>
<span class="normal"><a href="#__codelineno-0-817"> 817</a></span>
<span class="normal"><a href="#__codelineno-0-818"> 818</a></span>
<span class="normal"><a href="#__codelineno-0-819"> 819</a></span>
<span class="normal"><a href="#__codelineno-0-820"> 820</a></span>
<span class="normal"><a href="#__codelineno-0-821"> 821</a></span>
<span class="normal"><a href="#__codelineno-0-822"> 822</a></span>
<span class="normal"><a href="#__codelineno-0-823"> 823</a></span>
<span class="normal"><a href="#__codelineno-0-824"> 824</a></span>
<span class="normal"><a href="#__codelineno-0-825"> 825</a></span>
<span class="normal"><a href="#__codelineno-0-826"> 826</a></span>
<span class="normal"><a href="#__codelineno-0-827"> 827</a></span>
<span class="normal"><a href="#__codelineno-0-828"> 828</a></span>
<span class="normal"><a href="#__codelineno-0-829"> 829</a></span>
<span class="normal"><a href="#__codelineno-0-830"> 830</a></span>
<span class="normal"><a href="#__codelineno-0-831"> 831</a></span>
<span class="normal"><a href="#__codelineno-0-832"> 832</a></span>
<span class="normal"><a href="#__codelineno-0-833"> 833</a></span>
<span class="normal"><a href="#__codelineno-0-834"> 834</a></span>
<span class="normal"><a href="#__codelineno-0-835"> 835</a></span>
<span class="normal"><a href="#__codelineno-0-836"> 836</a></span>
<span class="normal"><a href="#__codelineno-0-837"> 837</a></span>
<span class="normal"><a href="#__codelineno-0-838"> 838</a></span>
<span class="normal"><a href="#__codelineno-0-839"> 839</a></span>
<span class="normal"><a href="#__codelineno-0-840"> 840</a></span>
<span class="normal"><a href="#__codelineno-0-841"> 841</a></span>
<span class="normal"><a href="#__codelineno-0-842"> 842</a></span>
<span class="normal"><a href="#__codelineno-0-843"> 843</a></span>
<span class="normal"><a href="#__codelineno-0-844"> 844</a></span>
<span class="normal"><a href="#__codelineno-0-845"> 845</a></span>
<span class="normal"><a href="#__codelineno-0-846"> 846</a></span>
<span class="normal"><a href="#__codelineno-0-847"> 847</a></span>
<span class="normal"><a href="#__codelineno-0-848"> 848</a></span>
<span class="normal"><a href="#__codelineno-0-849"> 849</a></span>
<span class="normal"><a href="#__codelineno-0-850"> 850</a></span>
<span class="normal"><a href="#__codelineno-0-851"> 851</a></span>
<span class="normal"><a href="#__codelineno-0-852"> 852</a></span>
<span class="normal"><a href="#__codelineno-0-853"> 853</a></span>
<span class="normal"><a href="#__codelineno-0-854"> 854</a></span>
<span class="normal"><a href="#__codelineno-0-855"> 855</a></span>
<span class="normal"><a href="#__codelineno-0-856"> 856</a></span>
<span class="normal"><a href="#__codelineno-0-857"> 857</a></span>
<span class="normal"><a href="#__codelineno-0-858"> 858</a></span>
<span class="normal"><a href="#__codelineno-0-859"> 859</a></span>
<span class="normal"><a href="#__codelineno-0-860"> 860</a></span>
<span class="normal"><a href="#__codelineno-0-861"> 861</a></span>
<span class="normal"><a href="#__codelineno-0-862"> 862</a></span>
<span class="normal"><a href="#__codelineno-0-863"> 863</a></span>
<span class="normal"><a href="#__codelineno-0-864"> 864</a></span>
<span class="normal"><a href="#__codelineno-0-865"> 865</a></span>
<span class="normal"><a href="#__codelineno-0-866"> 866</a></span>
<span class="normal"><a href="#__codelineno-0-867"> 867</a></span>
<span class="normal"><a href="#__codelineno-0-868"> 868</a></span>
<span class="normal"><a href="#__codelineno-0-869"> 869</a></span>
<span class="normal"><a href="#__codelineno-0-870"> 870</a></span>
<span class="normal"><a href="#__codelineno-0-871"> 871</a></span>
<span class="normal"><a href="#__codelineno-0-872"> 872</a></span>
<span class="normal"><a href="#__codelineno-0-873"> 873</a></span>
<span class="normal"><a href="#__codelineno-0-874"> 874</a></span>
<span class="normal"><a href="#__codelineno-0-875"> 875</a></span>
<span class="normal"><a href="#__codelineno-0-876"> 876</a></span>
<span class="normal"><a href="#__codelineno-0-877"> 877</a></span>
<span class="normal"><a href="#__codelineno-0-878"> 878</a></span>
<span class="normal"><a href="#__codelineno-0-879"> 879</a></span>
<span class="normal"><a href="#__codelineno-0-880"> 880</a></span>
<span class="normal"><a href="#__codelineno-0-881"> 881</a></span>
<span class="normal"><a href="#__codelineno-0-882"> 882</a></span>
<span class="normal"><a href="#__codelineno-0-883"> 883</a></span>
<span class="normal"><a href="#__codelineno-0-884"> 884</a></span>
<span class="normal"><a href="#__codelineno-0-885"> 885</a></span>
<span class="normal"><a href="#__codelineno-0-886"> 886</a></span>
<span class="normal"><a href="#__codelineno-0-887"> 887</a></span>
<span class="normal"><a href="#__codelineno-0-888"> 888</a></span>
<span class="normal"><a href="#__codelineno-0-889"> 889</a></span>
<span class="normal"><a href="#__codelineno-0-890"> 890</a></span>
<span class="normal"><a href="#__codelineno-0-891"> 891</a></span>
<span class="normal"><a href="#__codelineno-0-892"> 892</a></span>
<span class="normal"><a href="#__codelineno-0-893"> 893</a></span>
<span class="normal"><a href="#__codelineno-0-894"> 894</a></span>
<span class="normal"><a href="#__codelineno-0-895"> 895</a></span>
<span class="normal"><a href="#__codelineno-0-896"> 896</a></span>
<span class="normal"><a href="#__codelineno-0-897"> 897</a></span>
<span class="normal"><a href="#__codelineno-0-898"> 898</a></span>
<span class="normal"><a href="#__codelineno-0-899"> 899</a></span>
<span class="normal"><a href="#__codelineno-0-900"> 900</a></span>
<span class="normal"><a href="#__codelineno-0-901"> 901</a></span>
<span class="normal"><a href="#__codelineno-0-902"> 902</a></span>
<span class="normal"><a href="#__codelineno-0-903"> 903</a></span>
<span class="normal"><a href="#__codelineno-0-904"> 904</a></span>
<span class="normal"><a href="#__codelineno-0-905"> 905</a></span>
<span class="normal"><a href="#__codelineno-0-906"> 906</a></span>
<span class="normal"><a href="#__codelineno-0-907"> 907</a></span>
<span class="normal"><a href="#__codelineno-0-908"> 908</a></span>
<span class="normal"><a href="#__codelineno-0-909"> 909</a></span>
<span class="normal"><a href="#__codelineno-0-910"> 910</a></span>
<span class="normal"><a href="#__codelineno-0-911"> 911</a></span>
<span class="normal"><a href="#__codelineno-0-912"> 912</a></span>
<span class="normal"><a href="#__codelineno-0-913"> 913</a></span>
<span class="normal"><a href="#__codelineno-0-914"> 914</a></span>
<span class="normal"><a href="#__codelineno-0-915"> 915</a></span>
<span class="normal"><a href="#__codelineno-0-916"> 916</a></span>
<span class="normal"><a href="#__codelineno-0-917"> 917</a></span>
<span class="normal"><a href="#__codelineno-0-918"> 918</a></span>
<span class="normal"><a href="#__codelineno-0-919"> 919</a></span>
<span class="normal"><a href="#__codelineno-0-920"> 920</a></span>
<span class="normal"><a href="#__codelineno-0-921"> 921</a></span>
<span class="normal"><a href="#__codelineno-0-922"> 922</a></span>
<span class="normal"><a href="#__codelineno-0-923"> 923</a></span>
<span class="normal"><a href="#__codelineno-0-924"> 924</a></span>
<span class="normal"><a href="#__codelineno-0-925"> 925</a></span>
<span class="normal"><a href="#__codelineno-0-926"> 926</a></span>
<span class="normal"><a href="#__codelineno-0-927"> 927</a></span>
<span class="normal"><a href="#__codelineno-0-928"> 928</a></span>
<span class="normal"><a href="#__codelineno-0-929"> 929</a></span>
<span class="normal"><a href="#__codelineno-0-930"> 930</a></span>
<span class="normal"><a href="#__codelineno-0-931"> 931</a></span>
<span class="normal"><a href="#__codelineno-0-932"> 932</a></span>
<span class="normal"><a href="#__codelineno-0-933"> 933</a></span>
<span class="normal"><a href="#__codelineno-0-934"> 934</a></span>
<span class="normal"><a href="#__codelineno-0-935"> 935</a></span>
<span class="normal"><a href="#__codelineno-0-936"> 936</a></span>
<span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="k">class</span> <span class="nc">raw_env</span><span class="p">(</span><span class="n">AECEnv</span><span class="p">):</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raw graph collector environment.</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    This environment is based on a weighted (possible directed) graph using</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    networkx. The graph represents the environment structure and may define</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    obstacles by creating nodes with e.g. no connecting edges as well as</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    define collectable points. The weight of each edge defines the cost of</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    traversing that edge.</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">    Agents can move around the graph by traversing edges and collect defined</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">    points for a reward. Agents can also cheat by collecting points that have</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    already been collected. Cheating as well as rewards are</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    defined by a user-given function.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    Attributes:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        See AECEnv.</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;graph_collector&quot;</span><span class="p">,</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="s2">&quot;render_modes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;rgb_array&quot;</span><span class="p">,</span> <span class="s2">&quot;human&quot;</span><span class="p">],</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>        <span class="s2">&quot;is_parrallelizable&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="s2">&quot;render_fps&quot;</span><span class="p">:</span> <span class="n">FPS</span><span class="p">,</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="p">}</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="n">graph</span><span class="p">,</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="n">point_labels</span><span class="p">,</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="n">init_agent_labels</span><span class="p">,</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="n">max_collect</span><span class="p">,</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="n">nodes_per_row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="n">cheating_cost</span><span class="o">=</span><span class="k">lambda</span> <span class="n">point_label</span><span class="p">:</span> <span class="mi">500</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="n">collection_reward</span><span class="o">=</span><span class="k">lambda</span> <span class="n">point_label</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="n">reveal_cheating_cost</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="n">reveal_collection_reward</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="n">static_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="n">dynamic_display</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="n">render_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="p">):</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the graph collector environment.</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">            graph (networkx.Graph): Input directed or undirected graph</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">                defining the environment. Node labels must be a continuous set</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">                of integers starting at 0.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">            point_labels (list[int]): List of node labels to identify</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">                collectable points. All duplicate labels will be merged when</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">                creating points in the environment.</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">            init_agent_labels (list[int]): List of node labels to identify</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">                initial agent positions.</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">            max_collect (list[int]): List of maximum number of points each</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">                agent can collect.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">            nodes_per_row (int, optional): Number of nodes to display per row.</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">                Defaults to None.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">            cheating_cost (function, optional): Function that takes a node</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">                label and returns the cost of cheating by collecting an</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">                already collected point. Influences reward for collecting</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">                points. Defaults to lambda node_label: 500 * 0.5.</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">            collection_reward (function, optional): Function that takes a point</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">                label and returns the reward for collecting that point.</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">                Defaults to lambda point_label: 100.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">            reveal_cheating_cost (bool, optional): Whether to reveal the</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">                cheating costs to the agent in observations. Defaults to True.</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">            reveal_collection_reward (bool, optional): Whether to reveal the</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">                collection rewards to the agent in observations. Defaults to</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">                True.</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">            static_graph (bool, optional): Whether the underlying graph is</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">                static and never changes. Significantly impacts performance</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">                since everything in the environment have to be re-rendered</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">                for every frame to ensure consistency. May also influence the</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">                performance of policies as e.g. shortest paths will need to be</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">                recomputed for every action to determine optimal agent</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">                movement. Defaults to True.</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">            dynamic_display (bool, optional): Whether to dynamically adjust</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">                the display size to the graph size. Defaults to False.</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">            seed (int, optional): Seed for random number generator. Defaults</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">                to None.</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">            render_mode (str, optional): Render mode. Supported modes are</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">                specified in environment&#39;s metadata[&quot;render_modes&quot;] dict.</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">                Defaults to None.</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="n">gymnasium</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initializing graph collector environment...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="k">assert</span> <span class="p">(</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="n">render_mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;render_modes&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">render_mode</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="p">),</span> <span class="p">(</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="sa">f</span><span class="s2">&quot;render_mode: </span><span class="si">{</span><span class="n">render_mode</span><span class="si">}</span><span class="s2"> is not supported. &quot;</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>            <span class="sa">f</span><span class="s2">&quot;Supported modes: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;render_modes&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="n">gymnasium</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot; - Validating input positions...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="c1"># Check that all agent and point labels are nodes in the graph.</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>            <span class="n">label</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">init_agent_labels</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="p">),</span> <span class="s2">&quot;Agent labels must be nodes in the graph!&quot;</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="n">label</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">point_labels</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="p">),</span> <span class="s2">&quot;Point labels must be nodes in the graph!&quot;</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="c1"># Disallow agents to spawn inside obstacles as they would</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="c1"># not be able to move, i.e., agent labels must have neighbors.</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="nb">any</span><span class="p">(</span><span class="kc">True</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">agent_label</span><span class="p">))</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>            <span class="k">for</span> <span class="n">agent_label</span> <span class="ow">in</span> <span class="n">init_agent_labels</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="p">),</span> <span class="s2">&quot;Agent labels must not encode obstacles!&quot;</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="c1"># Allow but issue warning for points inside obstacles as they just</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="c1"># cannot be collected.</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="kc">True</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">point_label</span><span class="p">))</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="k">for</span> <span class="n">point_label</span> <span class="ow">in</span> <span class="n">point_labels</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="p">):</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="n">gymnasium</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>                <span class="s2">&quot;Some points are inside obstacles and cannot be collected!&quot;</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="p">)</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="c1"># Warn if points are overlapping.</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">point_labels</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">point_labels</span><span class="p">)):</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="n">gymnasium</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Some points overlap and will be merged!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="n">gymnasium</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot; - Seeding environment...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="c1"># Remove duplicate points.</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_point_labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">point_labels</span><span class="p">))</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">init_agent_labels</span> <span class="o">=</span> <span class="n">init_agent_labels</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">render_mode</span> <span class="o">=</span> <span class="n">render_mode</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cheating_cost</span> <span class="o">=</span> <span class="n">cheating_cost</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collection_reward</span> <span class="o">=</span> <span class="n">collection_reward</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reveal_cheating_cost</span> <span class="o">=</span> <span class="n">reveal_cheating_cost</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reveal_collection_reward</span> <span class="o">=</span> <span class="n">reveal_collection_reward</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">static_graph</span> <span class="o">=</span> <span class="n">static_graph</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="k">if</span> <span class="n">nodes_per_row</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>            <span class="n">nodes_per_row</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">)))</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_per_row</span> <span class="o">=</span> <span class="n">nodes_per_row</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="c1"># For dynamic displaying, we adjust the screen width s.t.</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="c1"># nodes are displayed as squares.</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="k">if</span> <span class="n">dynamic_display</span><span class="p">:</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>            <span class="k">global</span> <span class="n">SCREEN_WIDTH</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>            <span class="n">rows</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">/</span> <span class="n">nodes_per_row</span><span class="p">)</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_per_row</span> <span class="o">/</span> <span class="n">rows</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="n">SCREEN_WIDTH</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">SCREEN_HEIGHT</span> <span class="o">*</span> <span class="n">aspect_ratio</span><span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">node_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_shape</span><span class="p">(</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">),</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nodes_per_row</span><span class="p">,</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>            <span class="n">SCREEN_WIDTH</span><span class="p">,</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>            <span class="n">SCREEN_HEIGHT</span><span class="p">,</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="p">)</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reward_range</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agents</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>            <span class="sa">f</span><span class="s2">&quot;agent_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_agent_labels</span><span class="p">))</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="p">]</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">possible_agents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">[:]</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agent_name_mapping</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>            <span class="n">agent</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">agent</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">)</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="p">}</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_agent_selector</span> <span class="o">=</span> <span class="n">agent_selector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">)</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_collect</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>            <span class="n">agent</span><span class="p">:</span> <span class="n">max_collect</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">agent</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">)</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="p">}</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="n">gymnasium</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot; - Setting up action spaces...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">action_spaces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_action_spaces</span><span class="p">(</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="p">)</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="n">gymnasium</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot; - Setting up observation spaces...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">observation_spaces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_observation_spaces</span><span class="p">(</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">),</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_point_labels</span><span class="p">),</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">,</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reveal_cheating_cost</span><span class="p">,</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reveal_collection_reward</span><span class="p">,</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>            <span class="n">SCREEN_WIDTH</span><span class="p">,</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>            <span class="n">SCREEN_HEIGHT</span><span class="p">,</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>        <span class="p">)</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="n">gymnasium</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot; - Setting up state space...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_state_space</span><span class="p">(</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">),</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_point_labels</span><span class="p">),</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">),</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>            <span class="n">SCREEN_WIDTH</span><span class="p">,</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>            <span class="n">SCREEN_HEIGHT</span><span class="p">,</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="p">)</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="c1"># The following are set in reset().</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">total_points_collected</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agent_selection</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">has_reset</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">terminate</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">truncate</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="c1"># Dicts with agent as key.</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cumulative_rewards</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">terminations</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">truncations</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">infos</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cumulative_rewards</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="c1"># pygame</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">surf</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cached_obstacle_surf</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">isopen</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="n">gymnasium</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Environment initialized.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>    <span class="k">def</span> <span class="nf">_get_node_shape</span><span class="p">(</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">n_nodes</span><span class="p">,</span> <span class="n">nodes_per_row</span><span class="p">,</span> <span class="n">screen_width</span><span class="p">,</span> <span class="n">screen_height</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>    <span class="p">):</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the display width and height of a node.</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">            n_nodes (int): Number of nodes in the graph.</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">            nodes_per_row (int): Number of nodes to display per row.</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">            screen_width (int): Width of the display.</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">            screen_height (int): Height of the display.</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">            tuple: Tuple containing the display width and height of a node.</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="n">width</span> <span class="o">=</span> <span class="n">screen_width</span> <span class="o">/</span> <span class="n">nodes_per_row</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="n">height</span> <span class="o">=</span> <span class="n">screen_height</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n_nodes</span> <span class="o">/</span> <span class="n">nodes_per_row</span><span class="p">)</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="k">return</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>    <span class="k">def</span> <span class="nf">_get_action_spaces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agents</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves action spaces for all agents.</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">        Each action is a neighbouring node to move to (by node label) or</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">        to collect the current point (if the node is defined as one) by</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">        issuing the `collect` action, -1.</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="sd">            agents (list[str]): List of agent names.</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">            nodes (list[int]): List of node labels.</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">            dict: Dictionary of discrete action spaces.</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>        <span class="n">action_spaces</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>            <span class="n">agent</span><span class="p">:</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Discrete</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">start</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>            <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">agents</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>        <span class="p">}</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>        <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Generates a sample from the space.</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">            A sample is a neighbouring node chosen uniformly at random.</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">            Args:</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">                mask (np.ndarray, optional): An optimal mask for if an action</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">                    can be selected where `1` represents valid actions and `0`</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">                    invalid or infeasible actions. Defaults to None.</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">            Returns:</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">                int: Node label of the randomly sampled neighbouring node.</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">            &quot;&quot;&quot;</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>            <span class="n">agent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_selection</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>            <span class="k">assert</span> <span class="n">agent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>                <span class="s2">&quot;Agent is required to sample action but none is selected yet. &quot;</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>                <span class="s2">&quot;Did you call reset() before sampling?&quot;</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>            <span class="p">)</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>                <span class="s2">&quot;Collectors are required to sample action but none are &quot;</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>                <span class="s2">&quot;created yet. Did you call reset() before sampling?&quot;</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>            <span class="p">)</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>            <span class="n">action_mask</span><span class="p">,</span> <span class="n">collect_action_validity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_action_mask</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>            <span class="n">possible_actions</span> <span class="o">=</span> <span class="n">action_mask</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>            <span class="k">if</span> <span class="n">collect_action_validity</span><span class="p">:</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>                <span class="n">possible_actions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">possible_actions</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>            <span class="k">return</span> <span class="p">(</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">possible_actions</span><span class="p">)</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">possible_actions</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>                <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>            <span class="p">)</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>        <span class="c1"># Replace standard sample method s.t. we check for path validity.</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>        <span class="k">for</span> <span class="n">action_space</span> <span class="ow">in</span> <span class="n">action_spaces</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>            <span class="n">action_space</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span> <span class="n">sample</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>        <span class="k">return</span> <span class="n">action_spaces</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>    <span class="k">def</span> <span class="nf">_get_observation_spaces</span><span class="p">(</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="n">n_nodes</span><span class="p">,</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>        <span class="n">n_points</span><span class="p">,</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>        <span class="n">agents</span><span class="p">,</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>        <span class="n">reveal_cheating_cost</span><span class="p">,</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>        <span class="n">reveal_collection_reward</span><span class="p">,</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>        <span class="n">screen_width</span><span class="p">,</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>        <span class="n">screen_height</span><span class="p">,</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>    <span class="p">):</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves observation spaces for all agents.</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">        Each observation consist of a list of the point and agent positions as</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">        node labels, collected points, an image representing the environment,</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">        an action mask representing valid actions for the current agent, and</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">        whether the agent can issue the `collect` (-1) action.</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">            n_nodes (int): Number of nodes in the graph.</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">            n_points (int): Number of points in the graph.</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="sd">            agents (list[str]): List of agent names.</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="sd">            reveal_cheating_cost (bool): Whether to include cheating cost.</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="sd">            reveal_collection_reward (bool): Whether to include collection</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">                rewards.</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">            screen_width (int): Width of display screen.</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">            screen_height (int): Height of display screen.</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">            dict: Dictionary of observation spaces keyed by agent name.</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="n">spaces</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>            <span class="c1"># List of node labels, where points/collectors are located.</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>            <span class="s2">&quot;point_labels&quot;</span><span class="p">:</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>                <span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_points</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>            <span class="p">),</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>            <span class="s2">&quot;collector_labels&quot;</span><span class="p">:</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>                <span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">agents</span><span class="p">),),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>            <span class="p">),</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>            <span class="c1"># No. of times each point has been collected.</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>            <span class="s2">&quot;collected&quot;</span><span class="p">:</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>                <span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_points</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>            <span class="p">),</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>            <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>                <span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>                <span class="n">high</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>                <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">screen_width</span><span class="p">,</span> <span class="n">screen_height</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>                <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>            <span class="p">),</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>            <span class="c1"># Action mask for the current agent representing valid</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>            <span class="c1"># actions in the current state.</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>            <span class="s2">&quot;action_mask&quot;</span><span class="p">:</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>                <span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>            <span class="p">),</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>            <span class="c1"># Whether it is possible for the current agent to issue</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>            <span class="c1"># the `collect` (-1) action.</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>            <span class="s2">&quot;collect_action_validity&quot;</span><span class="p">:</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Discrete</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>        <span class="p">}</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>        <span class="k">if</span> <span class="n">reveal_cheating_cost</span><span class="p">:</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>            <span class="n">spaces</span><span class="p">[</span><span class="s2">&quot;cheating_cost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>                <span class="n">low</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_points</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>            <span class="p">)</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>        <span class="k">if</span> <span class="n">reveal_collection_reward</span><span class="p">:</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>            <span class="n">spaces</span><span class="p">[</span><span class="s2">&quot;collection_reward&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>                <span class="n">low</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_points</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>            <span class="p">)</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>        <span class="n">observation_spaces</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>            <span class="n">agent</span><span class="p">:</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span><span class="n">spaces</span><span class="p">)</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">agents</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>        <span class="p">}</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>        <span class="k">return</span> <span class="n">observation_spaces</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>    <span class="k">def</span> <span class="nf">_get_state_space</span><span class="p">(</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">n_nodes</span><span class="p">,</span> <span class="n">n_points</span><span class="p">,</span> <span class="n">n_agents</span><span class="p">,</span> <span class="n">screen_width</span><span class="p">,</span> <span class="n">screen_height</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>    <span class="p">):</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves state space.</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">        The global state consists of a list of the point and agent positions</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">        as node labels, collected points, and an image representing the</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">        environment.</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">            n_nodes (int): Number of nodes in the graph.</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">            n_points (int): Number of points in the graph.</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="sd">            n_agents (int): Number of agents.</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">            screen_width (int): Width of display screen.</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="sd">            screen_height (int): Height of display screen.</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a><span class="sd">            gymnasium.spaces.Dict: State space.</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>        <span class="n">state_space</span> <span class="o">=</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>            <span class="p">{</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>                <span class="c1"># List of node labels, where points/collectors are located.</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>                <span class="s2">&quot;point_labels&quot;</span><span class="p">:</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>                    <span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_points</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>                <span class="p">),</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>                <span class="s2">&quot;collector_labels&quot;</span><span class="p">:</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>                    <span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_agents</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>                <span class="p">),</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>                <span class="c1"># No. of times each point has been collected.</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>                <span class="s2">&quot;collected&quot;</span><span class="p">:</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>                    <span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_points</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>                <span class="p">),</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>                <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>                    <span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>                    <span class="n">high</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>                    <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">screen_width</span><span class="p">,</span> <span class="n">screen_height</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>                    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>                <span class="p">),</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>                <span class="s2">&quot;cheating_cost&quot;</span><span class="p">:</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>                    <span class="n">low</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>                    <span class="n">high</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>                    <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_points</span><span class="p">,),</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>                    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>                <span class="p">),</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>                <span class="s2">&quot;collection_reward&quot;</span><span class="p">:</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>                    <span class="n">low</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>                    <span class="n">high</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>                    <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_points</span><span class="p">,),</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>                    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>                <span class="p">),</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>            <span class="p">}</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>        <span class="p">)</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>        <span class="k">return</span> <span class="n">state_space</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>    <span class="k">def</span> <span class="nf">_get_node_position</span><span class="p">(</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">node_label</span><span class="p">,</span> <span class="n">nodes_per_row</span><span class="p">,</span> <span class="n">node_width</span><span class="p">,</span> <span class="n">node_height</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>    <span class="p">):</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the position of a node to be displayed on the screen.</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a><span class="sd">            node_label (int): Node label.</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="sd">            nodes_per_row (int): No. of nodes per row.</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="sd">            node_width (int): Display width of a node.</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a><span class="sd">            node_height (int): Display height of a node.</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="sd">            tuple: (x, y) position of the node (with origin at top-left).</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">node_label</span> <span class="o">%</span> <span class="n">nodes_per_row</span><span class="p">)</span> <span class="o">*</span> <span class="n">node_width</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">node_label</span> <span class="o">//</span> <span class="n">nodes_per_row</span><span class="p">)</span> <span class="o">*</span> <span class="n">node_height</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>    <span class="k">def</span> <span class="nf">_create_collectors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_agent_labels</span><span class="p">,</span> <span class="n">agents</span><span class="p">):</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates collector for each agent as a dict.</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">            init_agent_labels (list[int]): List of node labels representing</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">                initial agent positions.</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="sd">            agents (list[str]): List of agent names.</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a><span class="sd">            dict: Dictionary of collectors keyed by agent name.</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>        <span class="n">collectors</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>            <span class="n">agent</span><span class="p">:</span> <span class="n">Collector</span><span class="p">(</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>                <span class="n">pos</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_node_position</span><span class="p">(</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>                    <span class="n">node_label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>                    <span class="n">nodes_per_row</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_per_row</span><span class="p">,</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>                    <span class="n">node_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_width</span><span class="p">,</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>                    <span class="n">node_height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_height</span><span class="p">,</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>                <span class="p">),</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>                <span class="n">scaling</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>                <span class="n">translation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>                <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>                <span class="nb">id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;collector_</span><span class="si">{</span><span class="n">agent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>            <span class="p">)</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>            <span class="k">for</span> <span class="n">agent</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">agents</span><span class="p">,</span> <span class="n">init_agent_labels</span><span class="p">)</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>        <span class="p">}</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>        <span class="k">return</span> <span class="n">collectors</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>    <span class="k">def</span> <span class="nf">_create_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point_labels</span><span class="p">):</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates points from given node labels.</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a><span class="sd">        Note that this merges all points at the same node into a single</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="sd">        point.</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a><span class="sd">            point_labels (list[int]): Point positions.</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="sd">            dict: Dictionary of points keyed by node labels.</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>        <span class="n">points</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>            <span class="n">label</span><span class="p">:</span> <span class="n">Point</span><span class="p">(</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>                <span class="n">pos</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_node_position</span><span class="p">(</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>                    <span class="n">node_label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>                    <span class="n">nodes_per_row</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_per_row</span><span class="p">,</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>                    <span class="n">node_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_width</span><span class="p">,</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>                    <span class="n">node_height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_height</span><span class="p">,</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>                <span class="p">),</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>                <span class="n">scaling</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>                <span class="n">translation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>                <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>                <span class="nb">id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;point_</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>            <span class="p">)</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">point_labels</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>        <span class="p">}</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>        <span class="k">return</span> <span class="n">points</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>    <span class="k">def</span> <span class="nf">_create_image_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surf</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns image array from pygame surface.</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="sd">            surf (pygame.Surface): Surface to convert to image array.</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="sd">            size (tuple): Tuple of (width, height) to scale surface to.</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a><span class="sd">            np.ndarray: Image array.</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>        <span class="n">scaled_surf</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">smoothscale</span><span class="p">(</span><span class="n">surf</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">surfarray</span><span class="o">.</span><span class="n">pixels3d</span><span class="p">(</span><span class="n">scaled_surf</span><span class="p">)),</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>        <span class="p">)</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>    <span class="k">def</span> <span class="nf">reward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur_node</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns reward for executing action in cur_node.</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="sd">        If the action is `collect` (-1), we add a reward for collecting the</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="sd">        point. However, if the point has already been collected, we add a</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">        penalty for cheating.</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="sd">        If the action is a label of a new node, the reward is the cost of</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">        traversing the edge between the current and new node represented by</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a><span class="sd">        the weight of the edge.</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="sd">            cur_node (int): Node label of current node.</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">            action (int): Action to execute, which is either a node label or</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a><span class="sd">                `collect` (-1).</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="sd">            ValueError: No edge exists between current and new node of action</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="sd">                or if the action is `collect` (-1) and cur_node is not a point.</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a><span class="sd">            float: Reward</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>        <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>            <span class="k">assert</span> <span class="n">cur_node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="p">(</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>                <span class="sa">f</span><span class="s2">&quot;Node </span><span class="si">{</span><span class="n">cur_node</span><span class="si">}</span><span class="s2"> is not a point. Action cannot be `collect` &quot;</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>                <span class="s2">&quot;(-1).&quot;</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>            <span class="p">)</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>            <span class="c1"># Add reward for collecting a point, and add penalty if cheating.</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>            <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_reward</span><span class="p">(</span><span class="n">cur_node</span><span class="p">)</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">cur_node</span><span class="p">]</span><span class="o">.</span><span class="n">is_collected</span><span class="p">():</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>                <span class="n">reward</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cheating_cost</span><span class="p">(</span><span class="n">cur_node</span><span class="p">)</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>                <span class="n">reward</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">adj</span><span class="p">[</span><span class="n">cur_node</span><span class="p">][</span><span class="n">action</span><span class="p">][</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>                    <span class="sa">f</span><span class="s2">&quot;There is no weighted edge between node </span><span class="si">{</span><span class="n">cur_node</span><span class="si">}</span><span class="s2"> and &quot;</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2">. Reward cannot be calculated.&quot;</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>                <span class="p">)</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>        <span class="k">return</span> <span class="n">reward</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>    <span class="k">def</span> <span class="nf">_state</span><span class="p">(</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>        <span class="n">graph</span><span class="p">,</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>        <span class="n">points</span><span class="p">,</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>        <span class="n">collectors</span><span class="p">,</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>        <span class="n">reveal_cheating_cost</span><span class="p">,</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>        <span class="n">reveal_collection_reward</span><span class="p">,</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>    <span class="p">):</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves state of the current global environment.</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a><span class="sd">            graph (networkx.Graph): Graph representing the environment.</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="sd">            points (dict): Dictionary of points keyed by node labels.</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="sd">            collectors (dict): Dictionary of collectors keyed by agent names.</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a><span class="sd">            reveal_cheating_cost (bool): Whether to reveal cheating cost.</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a><span class="sd">            reveal_collection_reward (bool): Whether to reveal collection</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a><span class="sd">                reward.</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a><span class="sd">            dict: Current global state.</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>        <span class="n">state</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>            <span class="s2">&quot;point_labels&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>                <span class="p">[</span><span class="n">point</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="o">.</span><span class="n">values</span><span class="p">()],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>            <span class="p">),</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>            <span class="s2">&quot;collector_labels&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>                <span class="p">[</span><span class="n">collector</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">collector</span> <span class="ow">in</span> <span class="n">collectors</span><span class="o">.</span><span class="n">values</span><span class="p">()],</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>                <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>            <span class="p">),</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>            <span class="s2">&quot;collected&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>                <span class="p">[</span><span class="n">point</span><span class="o">.</span><span class="n">get_collect_counter</span><span class="p">()</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="o">.</span><span class="n">values</span><span class="p">()],</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>                <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>            <span class="p">),</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>            <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">render_mode</span><span class="o">=</span><span class="s2">&quot;rgb_array&quot;</span><span class="p">),</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>        <span class="p">}</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>        <span class="k">if</span> <span class="n">reveal_cheating_cost</span><span class="p">:</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>            <span class="n">state</span><span class="p">[</span><span class="s2">&quot;cheating_cost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cheating_cost</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">label</span><span class="p">)</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="o">.</span><span class="n">values</span><span class="p">()],</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>                <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>            <span class="p">)</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>        <span class="k">if</span> <span class="n">reveal_collection_reward</span><span class="p">:</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>            <span class="n">state</span><span class="p">[</span><span class="s2">&quot;collection_reward&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>                <span class="p">[</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">collection_reward</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>                    <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>                <span class="p">],</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>                <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>            <span class="p">)</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>        <span class="k">return</span> <span class="n">state</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>    <span class="k">def</span> <span class="nf">_get_action_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">):</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves action mask and whether `collect` (-1) can be issued.</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a><span class="sd">        The action mask is an array representing the validity of each action.</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a><span class="sd">        An action is valid if the agent can move to the corresponding node.</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a><span class="sd">        Valid actions are represented by `1`, and invalid actions are</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a><span class="sd">        represented by `0`.</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a><span class="sd">        The `collect` (-1) action is valid if the agent is at a point.</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a><span class="sd">            agent (str): Agent name.</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a><span class="sd">            tuple(np.ndarray, bool): Tuple action mask and validity of the</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a><span class="sd">                `collect` (-1) action.</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>        <span class="n">action_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>        <span class="n">cur_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span><span class="o">.</span><span class="n">label</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>        <span class="n">neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">cur_node</span><span class="p">)</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>        <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">neighbors</span><span class="p">:</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>            <span class="n">action_mask</span><span class="p">[</span><span class="n">neighbor</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>        <span class="n">collect_action_validity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>        <span class="k">return</span> <span class="n">action_mask</span><span class="p">,</span> <span class="n">collect_action_validity</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>    <span class="k">def</span> <span class="nf">observe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">):</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>        <span class="c1"># FIXME: Warning for api_test /Users/lfwa/Library/Caches/pypoetry/</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>        <span class="c1"># virtualenvs/collector-gjPrMD7k-py3.10/lib/python3.10/site-packages/</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>        <span class="c1"># pettingzoo/test/api_test.py:60: UserWarning: Observation is not</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>        <span class="c1"># NumPy array</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>        <span class="c1"># warnings.warn(&quot;Observation is not NumPy array&quot;)</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>        <span class="n">obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">(</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">,</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">,</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reveal_cheating_cost</span><span class="p">,</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reveal_collection_reward</span><span class="p">,</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>        <span class="p">)</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>        <span class="p">(</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>            <span class="n">obs</span><span class="p">[</span><span class="s2">&quot;action_mask&quot;</span><span class="p">],</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>            <span class="n">obs</span><span class="p">[</span><span class="s2">&quot;collect_action_validity&quot;</span><span class="p">],</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_action_mask</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>        <span class="k">return</span> <span class="n">obs</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>    <span class="k">def</span> <span class="nf">state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">(</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>        <span class="p">)</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>        <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">possible_agents</span><span class="p">[:]</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_agent_selector</span><span class="o">.</span><span class="n">reinit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">)</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agent_selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent_selector</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_collectors</span><span class="p">(</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">init_agent_labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>        <span class="p">)</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_point_labels</span><span class="p">)</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">total_points_collected</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">has_reset</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">terminate</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">truncate</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cumulative_rewards</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">terminations</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">truncations</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">infos</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cumulative_rewards</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>        <span class="n">observations</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_info</span><span class="p">:</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>            <span class="k">return</span> <span class="n">observations</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>            <span class="k">return</span> <span class="n">observations</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">infos</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>        <span class="k">assert</span> <span class="p">(</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">has_reset</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>        <span class="p">),</span> <span class="s2">&quot;Environment has not been reset yet. Call env.reset() first.&quot;</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>        <span class="n">agent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_selection</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminations</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">truncations</span><span class="p">[</span><span class="n">agent</span><span class="p">]:</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_was_dead_step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>            <span class="c1"># Guard against first agent dying first since _was_dead_step()</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>            <span class="c1"># does not update agent_selection when that happens.</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_selection</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">:</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agent_selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent_selector</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>            <span class="k">return</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_space</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>            <span class="ow">and</span> <span class="n">action</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>        <span class="p">):</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>                <span class="sa">f</span><span class="s2">&quot;Action </span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2"> is not in the action space for &quot;</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>                <span class="sa">f</span><span class="s2">&quot;agent </span><span class="si">{</span><span class="n">agent</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>            <span class="p">)</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>        <span class="n">action_mask</span><span class="p">,</span> <span class="n">collect_action_validity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_action_mask</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>        <span class="n">collector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>        <span class="n">cur_node</span> <span class="o">=</span> <span class="n">collector</span><span class="o">.</span><span class="n">label</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>            <span class="n">action</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>            <span class="ow">and</span> <span class="n">action_mask</span><span class="p">[</span><span class="n">action</span><span class="p">]</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>            <span class="ow">or</span> <span class="p">(</span><span class="n">action</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">collect_action_validity</span><span class="p">)</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>        <span class="p">):</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>            <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reward</span><span class="p">(</span><span class="n">cur_node</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>            <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>                <span class="c1"># Collect point.</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>                <span class="n">collector</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">cur_node</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_points_collected</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>                <span class="p">)</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">total_points_collected</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>                <span class="c1"># Move agent to the new node label.</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>                <span class="n">collector</span><span class="o">.</span><span class="n">move</span><span class="p">(</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>                    <span class="n">position</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_node_position</span><span class="p">(</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>                        <span class="n">node_label</span><span class="o">=</span><span class="n">action</span><span class="p">,</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>                        <span class="n">nodes_per_row</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_per_row</span><span class="p">,</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>                        <span class="n">node_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_width</span><span class="p">,</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>                        <span class="n">node_height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_height</span><span class="p">,</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>                    <span class="p">),</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>                    <span class="n">label</span><span class="o">=</span><span class="n">action</span><span class="p">,</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>                <span class="p">)</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>            <span class="n">reward</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>        <span class="c1"># Update termination and truncation for agent.</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span><span class="o">.</span><span class="n">total_points_collected</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>            <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_collect</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>        <span class="p">):</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">terminations</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">terminate</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">terminations</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">truncate</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">truncations</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span> <span class="o">=</span> <span class="n">reward</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cumulative_rewards</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span> <span class="o">+=</span> <span class="n">reward</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>        <span class="c1"># Cumulative reward since agent has last acted.</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cumulative_rewards</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_accumulate_rewards</span><span class="p">()</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agent_selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent_selector</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_mode</span> <span class="o">==</span> <span class="s2">&quot;human&quot;</span><span class="p">:</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>        <span class="k">assert</span> <span class="p">(</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">has_reset</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>        <span class="p">),</span> <span class="s2">&quot;Environment has not been reset yet. Call env.reset() first.&quot;</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>            <span class="n">gymnasium</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>                <span class="sa">f</span><span class="s2">&quot;No render mode specified, skipping render. Please &quot;</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>                <span class="s2">&quot;specify render_mode as one of the supported modes &quot;</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;render_modes&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> at initialization.&quot;</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>            <span class="p">)</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">render_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">render_mode</span><span class="p">)</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>    <span class="k">def</span> <span class="nf">_render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">render_mode</span><span class="p">):</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Renders the environment.</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a><span class="sd">            render_mode (str): One of the supported render modes.</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a><span class="sd">            np.ndarray or None: Returns the rendered image if render_mode is</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a><span class="sd">                `rgb_array`, otherwise returns None.</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>        <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">render_mode</span> <span class="o">==</span> <span class="s2">&quot;human&quot;</span><span class="p">:</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>            <span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>            <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">(</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>                    <span class="p">(</span><span class="n">SCREEN_WIDTH</span><span class="p">,</span> <span class="n">SCREEN_HEIGHT</span><span class="p">)</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>                <span class="p">)</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>                <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Could not initialize pygame display: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_display</span><span class="p">:</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>                    <span class="n">error_msg</span> <span class="o">+=</span> <span class="s2">&quot; Try disabling `dynamic_display`.&quot;</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>                <span class="n">gymnasium</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>                <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clock</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">surf</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">Surface</span><span class="p">((</span><span class="n">SCREEN_WIDTH</span><span class="p">,</span> <span class="n">SCREEN_HEIGHT</span><span class="p">))</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>        <span class="c1"># Add white background.</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_render_obstacles</span><span class="p">(</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>            <span class="n">surf</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">,</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>            <span class="n">nodes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>            <span class="n">nodes_per_row</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_per_row</span><span class="p">,</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>            <span class="n">node_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_width</span><span class="p">,</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>            <span class="n">node_height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_height</span><span class="p">,</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>        <span class="p">)</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_render_points</span><span class="p">(</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>            <span class="n">surf</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">,</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>            <span class="n">points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">,</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>            <span class="n">point_size</span><span class="o">=</span><span class="n">POINT_SIZE</span><span class="p">,</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>        <span class="p">)</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_render_paths</span><span class="p">(</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>            <span class="n">surf</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">,</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>            <span class="n">collectors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">,</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>            <span class="n">path_size</span><span class="o">=</span><span class="n">PATH_SIZE</span><span class="p">,</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>        <span class="p">)</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_render_collectors</span><span class="p">(</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>            <span class="n">surf</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">,</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>            <span class="n">collectors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">,</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>            <span class="n">collector_len</span><span class="o">=</span><span class="n">COLLECTOR_LEN</span><span class="p">,</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>            <span class="n">collector_size</span><span class="o">=</span><span class="n">COLLECTOR_SIZE</span><span class="p">,</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>        <span class="p">)</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_render_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">)</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>        <span class="k">if</span> <span class="n">render_mode</span> <span class="o">==</span> <span class="s2">&quot;human&quot;</span><span class="p">:</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>            <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">pump</span><span class="p">()</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;render_fps&quot;</span><span class="p">])</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>            <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>        <span class="k">elif</span> <span class="n">render_mode</span> <span class="o">==</span> <span class="s2">&quot;rgb_array&quot;</span><span class="p">:</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_image_array</span><span class="p">(</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">,</span> <span class="p">(</span><span class="n">SCREEN_WIDTH</span><span class="p">,</span> <span class="n">SCREEN_HEIGHT</span><span class="p">)</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>            <span class="p">)</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>    <span class="k">def</span> <span class="nf">_render_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surf</span><span class="p">):</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Renders information text, e.g. stats about environment and actions.</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a><span class="sd">            surf (pygame.Surface): Surface to render text on.</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>        <span class="p">(</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>            <span class="n">stats</span><span class="p">,</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>            <span class="n">overall_total_points_collected</span><span class="p">,</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>            <span class="n">overall_unique_points_collected</span><span class="p">,</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>            <span class="n">overall_cheated</span><span class="p">,</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_stats</span><span class="p">()</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>        <span class="n">total_reward</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cumulative_rewards</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>        <span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">get_default_font</span><span class="p">(),</span> <span class="n">FONT_SIZE</span><span class="p">)</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>        <span class="n">text1</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>            <span class="p">(</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>                <span class="sa">f</span><span class="s2">&quot;Iteration: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iteration</span><span class="si">}</span><span class="s2"> | &quot;</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>                <span class="sa">f</span><span class="s2">&quot;Total points collected: </span><span class="si">{</span><span class="n">overall_total_points_collected</span><span class="si">}</span><span class="s2"> | &quot;</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>                <span class="s2">&quot;Unique points collected: &quot;</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">overall_unique_points_collected</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span><span class="si">}</span><span class="s2"> | &quot;</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>                <span class="sa">f</span><span class="s2">&quot;Cheated: </span><span class="si">{</span><span class="n">overall_cheated</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>            <span class="p">),</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>            <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>        <span class="p">)</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>        <span class="n">text2</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>            <span class="sa">f</span><span class="s2">&quot;Total cumulative reward: </span><span class="si">{</span><span class="n">total_reward</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>            <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>        <span class="p">)</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>        <span class="n">surf</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a>        <span class="n">surf</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">text2</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>    <span class="k">def</span> <span class="nf">_get_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves stats for all collectors.</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a><span class="sd">            tuple: Tuple of stats.</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>        <span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>        <span class="n">overall_total_points_collected</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>        <span class="n">overall_unique_points_collected</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>        <span class="n">overall_cheated</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>        <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">:</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>            <span class="n">collector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>            <span class="n">stats</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>                <span class="s2">&quot;total_points_collected&quot;</span><span class="p">:</span> <span class="n">collector</span><span class="o">.</span><span class="n">total_points_collected</span><span class="p">,</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>                <span class="s2">&quot;unique_points_collected&quot;</span><span class="p">:</span> <span class="n">collector</span><span class="o">.</span><span class="n">unique_points_collected</span><span class="p">,</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>                <span class="s2">&quot;cheated&quot;</span><span class="p">:</span> <span class="n">collector</span><span class="o">.</span><span class="n">cheated</span><span class="p">,</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>            <span class="p">}</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>            <span class="n">overall_total_points_collected</span> <span class="o">+=</span> <span class="n">collector</span><span class="o">.</span><span class="n">total_points_collected</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a>            <span class="n">overall_unique_points_collected</span> <span class="o">+=</span> <span class="p">(</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>                <span class="n">collector</span><span class="o">.</span><span class="n">unique_points_collected</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>            <span class="p">)</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a>            <span class="n">overall_cheated</span> <span class="o">+=</span> <span class="n">collector</span><span class="o">.</span><span class="n">cheated</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>        <span class="k">return</span> <span class="p">(</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>            <span class="n">stats</span><span class="p">,</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>            <span class="n">overall_total_points_collected</span><span class="p">,</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>            <span class="n">overall_unique_points_collected</span><span class="p">,</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>            <span class="n">overall_cheated</span><span class="p">,</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>        <span class="p">)</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>    <span class="k">def</span> <span class="nf">_render_obstacles</span><span class="p">(</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">surf</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">nodes_per_row</span><span class="p">,</span> <span class="n">node_width</span><span class="p">,</span> <span class="n">node_height</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>    <span class="p">):</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Renders obstacles (nodes w. no neighbors) as black rectangles.</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a><span class="sd">            surf (pygame.Surface): Surface to render obstacles on.</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a><span class="sd">            nodes (list): List of nodes.</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a><span class="sd">            nodes_per_row (int): No. of nodes to display per row.</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a><span class="sd">            node_width (int): Display width of a node.</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a><span class="sd">            node_height (int): Display height of a node.</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>        <span class="c1"># For static graphs we only have to render obstacles once.</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_obstacle_surf</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">static_graph</span><span class="p">:</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>            <span class="n">cached_obstacle_surf</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">Surface</span><span class="p">(</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>                <span class="p">(</span><span class="n">SCREEN_WIDTH</span><span class="p">,</span> <span class="n">SCREEN_HEIGHT</span><span class="p">)</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>            <span class="p">)</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>            <span class="c1"># Add white background.</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>            <span class="n">cached_obstacle_surf</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="kc">True</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">node</span><span class="p">)):</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_position</span><span class="p">(</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>                    <span class="n">node_label</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>                    <span class="n">nodes_per_row</span><span class="o">=</span><span class="n">nodes_per_row</span><span class="p">,</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>                    <span class="n">node_width</span><span class="o">=</span><span class="n">node_width</span><span class="p">,</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>                    <span class="n">node_height</span><span class="o">=</span><span class="n">node_height</span><span class="p">,</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>                <span class="p">)</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>                <span class="n">rect</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">node_width</span><span class="p">,</span> <span class="n">node_height</span><span class="p">)</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>                <span class="n">pygame</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">rect</span><span class="p">(</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>                    <span class="n">cached_obstacle_surf</span><span class="p">,</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>                    <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>                    <span class="n">rect</span><span class="o">=</span><span class="n">rect</span><span class="p">,</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>                <span class="p">)</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cached_obstacle_surf</span> <span class="o">=</span> <span class="n">cached_obstacle_surf</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>        <span class="n">surf</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cached_obstacle_surf</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>    <span class="k">def</span> <span class="nf">_render_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surf</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">point_size</span><span class="p">):</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Renders all points as circles.</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a><span class="sd">        Points are colored according to their collector as a pie chart.</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a><span class="sd">            surf (pygame.Surface): Surface to render points on.</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a><span class="sd">            points (list[Points]): List of points to render.</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a><span class="sd">            point_size (int): Render size of a point.</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_center</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>            <span class="n">bounding_box</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">Rect</span><span class="p">(</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>                <span class="n">x</span> <span class="o">-</span> <span class="n">point_size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">point_size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">point_size</span><span class="p">,</span> <span class="n">point_size</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>            <span class="p">)</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>            <span class="n">total_collections</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">get_collect_counter</span><span class="p">()</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>            <span class="n">start_angle</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>            <span class="k">if</span> <span class="n">total_collections</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>                <span class="n">pygame</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>                    <span class="n">surf</span><span class="p">,</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>                    <span class="n">point</span><span class="o">.</span><span class="n">color</span><span class="p">,</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>                    <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>                    <span class="n">point_size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>                <span class="p">)</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>                <span class="k">for</span> <span class="p">(</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>                    <span class="n">collector_id</span><span class="p">,</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>                    <span class="n">collections</span><span class="p">,</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>                <span class="p">)</span> <span class="ow">in</span> <span class="n">point</span><span class="o">.</span><span class="n">collector_tracker</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>                    <span class="k">if</span> <span class="n">collections</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>                        <span class="k">continue</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>                    <span class="n">arc_length</span> <span class="o">=</span> <span class="n">collections</span> <span class="o">/</span> <span class="n">total_collections</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>                    <span class="n">pygame</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>                        <span class="n">surf</span><span class="p">,</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="n">collector_id</span><span class="p">[</span><span class="mi">10</span><span class="p">:]]</span><span class="o">.</span><span class="n">color</span><span class="p">,</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>                        <span class="n">bounding_box</span><span class="p">,</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>                        <span class="n">start_angle</span><span class="p">,</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>                        <span class="n">start_angle</span> <span class="o">+</span> <span class="n">arc_length</span><span class="p">,</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>                        <span class="n">point_size</span><span class="p">,</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>                    <span class="n">start_angle</span> <span class="o">+=</span> <span class="n">arc_length</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>    <span class="k">def</span> <span class="nf">_render_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surf</span><span class="p">,</span> <span class="n">collectors</span><span class="p">,</span> <span class="n">path_size</span><span class="p">):</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Renders paths taken by collectors.</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a><span class="sd">        Colors are assigned to paths based on the collector that took it.</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a><span class="sd">        If paths overlap then they are colored in segments.</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a><span class="sd">            surf (pygame.Surface): Surface to render paths on.</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a><span class="sd">            collectors (dict): Dict of collectors.</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a><span class="sd">            path_size (int): Render size of paths.</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>        <span class="n">path_pairs</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>        <span class="k">for</span> <span class="n">collector</span> <span class="ow">in</span> <span class="n">collectors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>            <span class="n">path_pos_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">collector</span><span class="o">.</span><span class="n">path_positions</span><span class="p">)</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>            <span class="k">if</span> <span class="n">path_pos_len</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>                <span class="k">continue</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">path_pos_len</span><span class="p">):</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>                <span class="n">key</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>                    <span class="n">collector</span><span class="o">.</span><span class="n">path_positions</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>                    <span class="n">collector</span><span class="o">.</span><span class="n">path_positions</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>                <span class="p">)</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>                <span class="n">reverse_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>                <span class="c1"># We should not care whether it is (a, b) or (b, a).</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">path_pairs</span><span class="p">:</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>                    <span class="n">path_pairs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">collector</span><span class="p">]</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>                <span class="k">elif</span> <span class="n">reverse_key</span> <span class="ow">in</span> <span class="n">path_pairs</span><span class="p">:</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>                    <span class="n">path_pairs</span><span class="p">[</span><span class="n">reverse_key</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">collector</span><span class="p">]</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>                    <span class="n">path_pairs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">collector</span><span class="p">]</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>        <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">collectors</span> <span class="ow">in</span> <span class="n">path_pairs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>            <span class="n">total_collectors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">collectors</span><span class="p">)</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>            <span class="n">prev_x</span><span class="p">,</span> <span class="n">prev_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_center</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_center</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>            <span class="n">segment_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">prev_x</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_collectors</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>            <span class="n">segment_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">prev_y</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_collectors</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a>            <span class="k">for</span> <span class="n">collector</span> <span class="ow">in</span> <span class="n">collectors</span><span class="p">:</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>                <span class="n">pygame</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a>                    <span class="n">surf</span><span class="p">,</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>                    <span class="n">collector</span><span class="o">.</span><span class="n">color</span><span class="p">,</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>                    <span class="p">(</span><span class="n">prev_x</span><span class="p">,</span> <span class="n">prev_y</span><span class="p">),</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>                    <span class="p">(</span><span class="n">prev_x</span> <span class="o">+</span> <span class="n">segment_x</span><span class="p">,</span> <span class="n">prev_y</span> <span class="o">+</span> <span class="n">segment_y</span><span class="p">),</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a>                    <span class="n">path_size</span><span class="p">,</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>                <span class="p">)</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>                <span class="n">prev_x</span> <span class="o">+=</span> <span class="n">segment_x</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>                <span class="n">prev_y</span> <span class="o">+=</span> <span class="n">segment_y</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>    <span class="k">def</span> <span class="nf">_render_collectors</span><span class="p">(</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>        <span class="n">surf</span><span class="p">,</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>        <span class="n">collectors</span><span class="p">,</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>        <span class="n">collector_len</span><span class="p">,</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>        <span class="n">collector_size</span><span class="p">,</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>    <span class="p">):</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Renders all collectors as crosses.</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a><span class="sd">        Collectors are rotated when stacked to avoid overlapping.</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a><span class="sd">        Black borders are added to crosses.</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a><span class="sd">            surf (pygame.Surface): Surface to render collectors on.</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a><span class="sd">            collectors (dict): Dict of collectors.</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a><span class="sd">            collector_len (int): Length of collector cross.</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a><span class="sd">            collector_size (int): Size of collector cross.</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>        <span class="k">for</span> <span class="n">position</span><span class="p">,</span> <span class="n">colls</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">(</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>            <span class="n">collectors</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="k">lambda</span> <span class="n">col</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">position</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>        <span class="p">):</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>            <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_center</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>            <span class="n">colls</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">colls</span><span class="p">)</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a>            <span class="n">total_collectors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">colls</span><span class="p">)</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>            <span class="n">shift_increment</span> <span class="o">=</span> <span class="n">collector_len</span> <span class="o">/</span> <span class="n">total_collectors</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>            <span class="n">shift</span> <span class="o">=</span> <span class="n">collector_len</span> <span class="o">/</span> <span class="mi">2</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">collector</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colls</span><span class="p">):</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>                <span class="n">cross_rotate_shift</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">shift_increment</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>                <span class="c1"># Add black border to cross.</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>                <span class="n">border_size</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">collector_size</span> <span class="o">*</span> <span class="mf">1.7</span><span class="p">)</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>                <span class="n">pygame</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>                    <span class="n">surf</span><span class="p">,</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>                    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>                    <span class="n">start_pos</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">cross_rotate_shift</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>                    <span class="p">),</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>                    <span class="n">end_pos</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift</span> <span class="o">-</span> <span class="n">cross_rotate_shift</span><span class="p">,</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift</span><span class="p">,</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>                    <span class="p">),</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>                    <span class="n">width</span><span class="o">=</span><span class="n">border_size</span><span class="p">,</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>                <span class="p">)</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>                <span class="n">pygame</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>                    <span class="n">surf</span><span class="p">,</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>                    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>                    <span class="n">start_pos</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift</span><span class="p">,</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">cross_rotate_shift</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>                    <span class="p">),</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>                    <span class="n">end_pos</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift</span> <span class="o">-</span> <span class="n">cross_rotate_shift</span><span class="p">,</span>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>                    <span class="p">),</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a>                    <span class="n">width</span><span class="o">=</span><span class="n">border_size</span><span class="p">,</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a>                <span class="p">)</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a>                <span class="c1"># Draw cross.</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>                <span class="n">pygame</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>                    <span class="n">surf</span><span class="p">,</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>                    <span class="n">collector</span><span class="o">.</span><span class="n">color</span><span class="p">,</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>                    <span class="n">start_pos</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">cross_rotate_shift</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>                    <span class="p">),</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>                    <span class="n">end_pos</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift</span> <span class="o">-</span> <span class="n">cross_rotate_shift</span><span class="p">,</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift</span><span class="p">,</span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a>                    <span class="p">),</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a>                    <span class="n">width</span><span class="o">=</span><span class="n">collector_size</span><span class="p">,</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a>                <span class="p">)</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a>                <span class="n">pygame</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a>                    <span class="n">surf</span><span class="p">,</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a>                    <span class="n">collector</span><span class="o">.</span><span class="n">color</span><span class="p">,</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a>                    <span class="n">start_pos</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift</span><span class="p">,</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">cross_rotate_shift</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>                    <span class="p">),</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>                    <span class="n">end_pos</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a>                        <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift</span> <span class="o">-</span> <span class="n">cross_rotate_shift</span><span class="p">,</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>                    <span class="p">),</span>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a>                    <span class="n">width</span><span class="o">=</span><span class="n">collector_size</span><span class="p">,</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>                <span class="p">)</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>    <span class="k">def</span> <span class="nf">_center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the position centered on the node.</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a><span class="sd">            pos (tuple): Position to center.</span>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a><span class="sd">            tuple: Centered position.</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>        <span class="k">return</span> <span class="p">(</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a>            <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a>            <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a>        <span class="p">)</span>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a>    <span class="k">def</span> <span class="nf">observation_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">):</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_spaces</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a>    <span class="k">def</span> <span class="nf">action_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">):</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_spaces</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>    <span class="k">def</span> <span class="nf">seed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">gymnasium</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">seeding</span><span class="o">.</span><span class="n">np_random</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>        <span class="k">return</span> <span class="p">[</span><span class="n">seed</span><span class="p">]</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>            <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">isopen</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a>            <span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="datadynamics.environments.graph_collector.graph_collector.raw_env.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">point_labels</span><span class="p">,</span> <span class="n">init_agent_labels</span><span class="p">,</span> <span class="n">max_collect</span><span class="p">,</span> <span class="n">nodes_per_row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cheating_cost</span><span class="o">=</span><span class="k">lambda</span> <span class="n">point_label</span><span class="p">:</span> <span class="mi">500</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">collection_reward</span><span class="o">=</span><span class="k">lambda</span> <span class="n">point_label</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="n">reveal_cheating_cost</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reveal_collection_reward</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">static_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dynamic_display</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">render_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Initializes the graph collector environment.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>graph</code></td>
          <td>
                <code>networkx.<span title="networkx.Graph">Graph</span></code>
          </td>
          <td><p>Input directed or undirected graph
defining the environment. Node labels must be a continuous set
of integers starting at 0.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>point_labels</code></td>
          <td>
                <code>list[int]</code>
          </td>
          <td><p>List of node labels to identify
collectable points. All duplicate labels will be merged when
creating points in the environment.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>init_agent_labels</code></td>
          <td>
                <code>list[int]</code>
          </td>
          <td><p>List of node labels to identify
initial agent positions.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>max_collect</code></td>
          <td>
                <code>list[int]</code>
          </td>
          <td><p>List of maximum number of points each
agent can collect.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>nodes_per_row</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Number of nodes to display per row.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>cheating_cost</code></td>
          <td>
                <code>function</code>
          </td>
          <td><p>Function that takes a node
label and returns the cost of cheating by collecting an
already collected point. Influences reward for collecting
points. Defaults to lambda node_label: 500 * 0.5.</p></td>
          <td>
                <code>lambda point_label: 500 * 0.5</code>
          </td>
        </tr>
        <tr>
          <td><code>collection_reward</code></td>
          <td>
                <code>function</code>
          </td>
          <td><p>Function that takes a point
label and returns the reward for collecting that point.
Defaults to lambda point_label: 100.</p></td>
          <td>
                <code>lambda point_label: 100</code>
          </td>
        </tr>
        <tr>
          <td><code>reveal_cheating_cost</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to reveal the
cheating costs to the agent in observations. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>reveal_collection_reward</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to reveal the
collection rewards to the agent in observations. Defaults to
True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>static_graph</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether the underlying graph is
static and never changes. Significantly impacts performance
since everything in the environment have to be re-rendered
for every frame to ensure consistency. May also influence the
performance of policies as e.g. shortest paths will need to be
recomputed for every action to determine optimal agent
movement. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>dynamic_display</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to dynamically adjust
the display size to the graph size. Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>seed</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Seed for random number generator. Defaults
to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>render_mode</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Render mode. Supported modes are
specified in environment's metadata["render_modes"] dict.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datadynamics/environments/graph_collector/graph_collector.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="n">graph</span><span class="p">,</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="n">point_labels</span><span class="p">,</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="n">init_agent_labels</span><span class="p">,</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="n">max_collect</span><span class="p">,</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="n">nodes_per_row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="n">cheating_cost</span><span class="o">=</span><span class="k">lambda</span> <span class="n">point_label</span><span class="p">:</span> <span class="mi">500</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="n">collection_reward</span><span class="o">=</span><span class="k">lambda</span> <span class="n">point_label</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="n">reveal_cheating_cost</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="n">reveal_collection_reward</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="n">static_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="n">dynamic_display</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="n">render_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="p">):</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes the graph collector environment.</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">        graph (networkx.Graph): Input directed or undirected graph</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">            defining the environment. Node labels must be a continuous set</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">            of integers starting at 0.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        point_labels (list[int]): List of node labels to identify</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">            collectable points. All duplicate labels will be merged when</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">            creating points in the environment.</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        init_agent_labels (list[int]): List of node labels to identify</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">            initial agent positions.</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        max_collect (list[int]): List of maximum number of points each</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">            agent can collect.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        nodes_per_row (int, optional): Number of nodes to display per row.</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">            Defaults to None.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        cheating_cost (function, optional): Function that takes a node</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">            label and returns the cost of cheating by collecting an</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">            already collected point. Influences reward for collecting</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">            points. Defaults to lambda node_label: 500 * 0.5.</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">        collection_reward (function, optional): Function that takes a point</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">            label and returns the reward for collecting that point.</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">            Defaults to lambda point_label: 100.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">        reveal_cheating_cost (bool, optional): Whether to reveal the</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">            cheating costs to the agent in observations. Defaults to True.</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">        reveal_collection_reward (bool, optional): Whether to reveal the</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">            collection rewards to the agent in observations. Defaults to</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">            True.</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">        static_graph (bool, optional): Whether the underlying graph is</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">            static and never changes. Significantly impacts performance</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">            since everything in the environment have to be re-rendered</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">            for every frame to ensure consistency. May also influence the</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">            performance of policies as e.g. shortest paths will need to be</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">            recomputed for every action to determine optimal agent</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">            movement. Defaults to True.</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">        dynamic_display (bool, optional): Whether to dynamically adjust</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">            the display size to the graph size. Defaults to False.</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        seed (int, optional): Seed for random number generator. Defaults</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">            to None.</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        render_mode (str, optional): Render mode. Supported modes are</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">            specified in environment&#39;s metadata[&quot;render_modes&quot;] dict.</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">            Defaults to None.</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="n">gymnasium</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initializing graph collector environment...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="k">assert</span> <span class="p">(</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="n">render_mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;render_modes&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">render_mode</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="p">),</span> <span class="p">(</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="sa">f</span><span class="s2">&quot;render_mode: </span><span class="si">{</span><span class="n">render_mode</span><span class="si">}</span><span class="s2"> is not supported. &quot;</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="sa">f</span><span class="s2">&quot;Supported modes: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;render_modes&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="n">gymnasium</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot; - Validating input positions...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="c1"># Check that all agent and point labels are nodes in the graph.</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="n">label</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">init_agent_labels</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="p">),</span> <span class="s2">&quot;Agent labels must be nodes in the graph!&quot;</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="n">label</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">point_labels</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="p">),</span> <span class="s2">&quot;Point labels must be nodes in the graph!&quot;</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="c1"># Disallow agents to spawn inside obstacles as they would</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="c1"># not be able to move, i.e., agent labels must have neighbors.</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="nb">any</span><span class="p">(</span><span class="kc">True</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">agent_label</span><span class="p">))</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="k">for</span> <span class="n">agent_label</span> <span class="ow">in</span> <span class="n">init_agent_labels</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="p">),</span> <span class="s2">&quot;Agent labels must not encode obstacles!&quot;</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="c1"># Allow but issue warning for points inside obstacles as they just</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="c1"># cannot be collected.</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="kc">True</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">point_label</span><span class="p">))</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="k">for</span> <span class="n">point_label</span> <span class="ow">in</span> <span class="n">point_labels</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="p">):</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="n">gymnasium</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="s2">&quot;Some points are inside obstacles and cannot be collected!&quot;</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="p">)</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="c1"># Warn if points are overlapping.</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">point_labels</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">point_labels</span><span class="p">)):</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="n">gymnasium</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Some points overlap and will be merged!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="n">gymnasium</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot; - Seeding environment...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="c1"># Remove duplicate points.</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_point_labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">point_labels</span><span class="p">))</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">init_agent_labels</span> <span class="o">=</span> <span class="n">init_agent_labels</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">render_mode</span> <span class="o">=</span> <span class="n">render_mode</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">cheating_cost</span> <span class="o">=</span> <span class="n">cheating_cost</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">collection_reward</span> <span class="o">=</span> <span class="n">collection_reward</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">reveal_cheating_cost</span> <span class="o">=</span> <span class="n">reveal_cheating_cost</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">reveal_collection_reward</span> <span class="o">=</span> <span class="n">reveal_collection_reward</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">static_graph</span> <span class="o">=</span> <span class="n">static_graph</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="k">if</span> <span class="n">nodes_per_row</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="n">nodes_per_row</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">)))</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_per_row</span> <span class="o">=</span> <span class="n">nodes_per_row</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>    <span class="c1"># For dynamic displaying, we adjust the screen width s.t.</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="c1"># nodes are displayed as squares.</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>    <span class="k">if</span> <span class="n">dynamic_display</span><span class="p">:</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="k">global</span> <span class="n">SCREEN_WIDTH</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="n">rows</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">/</span> <span class="n">nodes_per_row</span><span class="p">)</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_per_row</span> <span class="o">/</span> <span class="n">rows</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="n">SCREEN_WIDTH</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">SCREEN_HEIGHT</span> <span class="o">*</span> <span class="n">aspect_ratio</span><span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">node_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_shape</span><span class="p">(</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">),</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_per_row</span><span class="p">,</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="n">SCREEN_WIDTH</span><span class="p">,</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="n">SCREEN_HEIGHT</span><span class="p">,</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="p">)</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">reward_range</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">agents</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="sa">f</span><span class="s2">&quot;agent_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_agent_labels</span><span class="p">))</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="p">]</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">possible_agents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">[:]</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">agent_name_mapping</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="n">agent</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">agent</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">)</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="p">}</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_agent_selector</span> <span class="o">=</span> <span class="n">agent_selector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">)</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">max_collect</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="n">agent</span><span class="p">:</span> <span class="n">max_collect</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">agent</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">)</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span class="p">}</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="n">gymnasium</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot; - Setting up action spaces...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">action_spaces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_action_spaces</span><span class="p">(</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>    <span class="p">)</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="n">gymnasium</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot; - Setting up observation spaces...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">observation_spaces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_observation_spaces</span><span class="p">(</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">),</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_point_labels</span><span class="p">),</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">,</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reveal_cheating_cost</span><span class="p">,</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reveal_collection_reward</span><span class="p">,</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="n">SCREEN_WIDTH</span><span class="p">,</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="n">SCREEN_HEIGHT</span><span class="p">,</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="p">)</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="n">gymnasium</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot; - Setting up state space...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">state_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_state_space</span><span class="p">(</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">),</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_point_labels</span><span class="p">),</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">),</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>        <span class="n">SCREEN_WIDTH</span><span class="p">,</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="n">SCREEN_HEIGHT</span><span class="p">,</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>    <span class="p">)</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>    <span class="c1"># The following are set in reset().</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_points_collected</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">agent_selection</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">has_reset</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">terminate</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">truncate</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>    <span class="c1"># Dicts with agent as key.</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_cumulative_rewards</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">terminations</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">truncations</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">infos</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">cumulative_rewards</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="c1"># pygame</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">surf</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">cached_obstacle_surf</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">isopen</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>    <span class="n">gymnasium</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Environment initialized.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="datadynamics.environments.graph_collector.graph_collector.raw_env.reward" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reward</span><span class="p">(</span><span class="n">cur_node</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Returns reward for executing action in cur_node.</p>
<p>If the action is <code>collect</code> (-1), we add a reward for collecting the
point. However, if the point has already been collected, we add a
penalty for cheating.
If the action is a label of a new node, the reward is the cost of
traversing the edge between the current and new node represented by
the weight of the edge.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>cur_node</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Node label of current node.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>action</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Action to execute, which is either a node label or
<code>collect</code> (-1).</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>ValueError</code>
          </td>
          <td><p>No edge exists between current and new node of action
or if the action is <code>collect</code> (-1) and cur_node is not a point.</p></td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>float</code></td>          <td>
          </td>
          <td><p>Reward</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datadynamics/environments/graph_collector/graph_collector.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-540" name="__codelineno-0-540"></a><span class="k">def</span> <span class="nf">reward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur_node</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns reward for executing action in cur_node.</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="sd">    If the action is `collect` (-1), we add a reward for collecting the</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="sd">    point. However, if the point has already been collected, we add a</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">    penalty for cheating.</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="sd">    If the action is a label of a new node, the reward is the cost of</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">    traversing the edge between the current and new node represented by</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a><span class="sd">    the weight of the edge.</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="sd">        cur_node (int): Node label of current node.</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">        action (int): Action to execute, which is either a node label or</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a><span class="sd">            `collect` (-1).</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="sd">        ValueError: No edge exists between current and new node of action</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="sd">            or if the action is `collect` (-1) and cur_node is not a point.</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a><span class="sd">        float: Reward</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>    <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>        <span class="k">assert</span> <span class="n">cur_node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="p">(</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>            <span class="sa">f</span><span class="s2">&quot;Node </span><span class="si">{</span><span class="n">cur_node</span><span class="si">}</span><span class="s2"> is not a point. Action cannot be `collect` &quot;</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>            <span class="s2">&quot;(-1).&quot;</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>        <span class="p">)</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>        <span class="c1"># Add reward for collecting a point, and add penalty if cheating.</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>        <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_reward</span><span class="p">(</span><span class="n">cur_node</span><span class="p">)</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">cur_node</span><span class="p">]</span><span class="o">.</span><span class="n">is_collected</span><span class="p">():</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>            <span class="n">reward</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cheating_cost</span><span class="p">(</span><span class="n">cur_node</span><span class="p">)</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>            <span class="n">reward</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">adj</span><span class="p">[</span><span class="n">cur_node</span><span class="p">][</span><span class="n">action</span><span class="p">][</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>                <span class="sa">f</span><span class="s2">&quot;There is no weighted edge between node </span><span class="si">{</span><span class="n">cur_node</span><span class="si">}</span><span class="s2"> and &quot;</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2">. Reward cannot be calculated.&quot;</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>            <span class="p">)</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>    <span class="k">return</span> <span class="n">reward</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="datadynamics.environments.graph_collector.graph_collector.env" class="doc doc-heading">
<code class="highlight language-python"><span class="n">env</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Creates a graph collector environment.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td><p>pettingzoo.utils.env.AECEnv: Created environment.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datadynamics/environments/graph_collector/graph_collector.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="k">def</span> <span class="nf">env</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a graph collector environment.</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        pettingzoo.utils.env.AECEnv: Created environment.</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="n">env</span> <span class="o">=</span> <span class="n">raw_env</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="k">return</span> <span class="n">env</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "navigation.instant", "navigation.top", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.b4d07000.min.js"></script>
      
    
  </body>
</html>